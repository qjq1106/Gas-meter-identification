{"version":3,"file":"detail.js","sources":["uni_modules/uni-upgrade-center/pages/version/detail.vue","../../../../微信开发者工具/HBuilderX/plugins/uniapp-cli-vite/uniPage:/dW5pX21vZHVsZXMvdW5pLXVwZ3JhZGUtY2VudGVyL3BhZ2VzL3ZlcnNpb24vZGV0YWlsLnZ1ZQ"],"sourcesContent":["<template>\r\n\t<view class=\"uni-container\">\r\n\t\t<view class=\"uni-header\">\r\n\t\t\t<view class=\"uni-group\">\r\n\t\t\t\t<view class=\"uni-title\">包类型</view>\r\n\t\t\t\t<view class=\"uni-sub-title\" style=\"display: flex;justify-content: center;align-items: center;\">\r\n\t\t\t\t\t{{type_valuetotext[formData.type]}}\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view v-if=\"!isStable\" class=\"uni-group\">\r\n\t\t\t\t<button class=\"uni-button\" type=\"warn\" size=\"mini\" @click=\"deletePackage\">删除</button>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<uni-forms ref=\"form\" :value=\"formData\" validateTrigger=\"bind\" :labelWidth=\"labelWidth\">\r\n\t\t\t<!-- region 基础信息 -->\r\n\t\t\t<uni-forms-item name=\"appid\" label=\"AppID\" required>\r\n\t\t\t\t<uni-easyinput :disabled=\"true\" v-model=\"formData.appid\" trim=\"both\" />\r\n\t\t\t</uni-forms-item>\r\n\t\t\t<uni-forms-item name=\"name\" label=\"应用名称\">\r\n\t\t\t\t<uni-easyinput :disabled=\"true\" v-model=\"formData.name\" trim=\"both\" />\r\n\t\t\t</uni-forms-item>\r\n\t\t\t<uni-forms-item name=\"title\" label=\"更新标题\">\r\n\t\t\t\t<uni-easyinput :disabled=\"detailsState\" placeholder=\"更新标题\" v-model=\"formData.title\" />\r\n\t\t\t</uni-forms-item>\r\n\t\t\t<uni-forms-item name=\"contents\" label=\"更新内容\" required>\r\n\t\t\t\t<textarea auto-height style=\"box-sizing: content-box;\" :disabled=\"detailsState\"\r\n\t\t\t\t\t@input=\"binddata('contents', $event.detail.value)\" class=\"uni-textarea-border\" placeholder=\"更新内容 (可换行)\"\r\n\t\t\t\t\t:value=\"formData.contents\" @update:value=\"val => formData.contents = val\"></textarea>\r\n\t\t\t</uni-forms-item>\r\n\t\t\t<uni-forms-item name=\"platform\" label=\"平台\" required>\r\n\t\t\t\t<!-- multiple 为 true 时才会反显 -->\r\n\t\t\t\t<uni-data-checkbox :disabled=\"true\" :multiple=\"isWGT\" v-model=\"formData.platform\"\r\n\t\t\t\t\t:localdata=\"platformLocaldata\" />\r\n\t\t\t</uni-forms-item>\r\n\t\t\t<uni-forms-item name=\"version\" label=\"版本号\" required>\r\n\t\t\t\t<uni-easyinput :disabled=\"true\" v-model=\"formData.version\" placeholder=\"当前包版本号，必须大于当前已上线版本号\" />\r\n\t\t\t</uni-forms-item>\r\n\t\t\t<!-- endregion -->\r\n\r\n\t\t\t<uni-forms-item v-if=\"isWGT\" key=\"min_uni_version\" name=\"min_uni_version\" label=\"原生App最低版本\"\r\n\t\t\t\t:required=\"isWGT\">\r\n\t\t\t\t<uni-easyinput :disabled=\"detailsState\" placeholder=\"原生App最低版本\" v-model=\"formData.min_uni_version\" />\r\n\t\t\t\t<show-info :content=\"minUniVersionContent\"></show-info>\r\n\t\t\t</uni-forms-item>\r\n\r\n\t\t\t<template v-if=\"enableUploadPackage && !detailsState\">\r\n\t\t\t\t<uni-forms-item label=\"存储选择\">\r\n\t\t\t\t\t<view class=\"flex\">\r\n\t\t\t\t\t\t<radio-group @change=\"e => uniFilePickerProvider = e.detail.value\" style=\"width: 100%;\">\r\n\t\t\t\t\t\t\t<view class=\"flex\" style=\"flex-wrap: nowrap;\">\r\n\t\t\t\t\t\t上传至：\r\n\t\t\t\t\t\t\t\t<label>\r\n\t\t\t\t\t\t\t\t\t<radio value=\"unicloud\" :checked=\"uniFilePickerProvider === 'unicloud'\"/><text>内置存储</text>\r\n\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t<label style=\"margin-left: 20rpx;\">\r\n\t\t\t\t\t\t\t\t\t<radio value=\"extStorage\" :checked=\"uniFilePickerProvider === 'extStorage'\"/><text>扩展存储</text>\r\n\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</radio-group>\r\n\t\t\t\t\t\t<text class=\"uni-sub-title\" style=\"margin-top: 10px;font-size: 12px;color: #666;width: 100%;\">内置存储是服务空间开通后自带的云存储，不支持自定义域名，不支持阶梯计费</text>\r\n\t\t\t\t\t\t<text class=\"uni-sub-title\" style=\"margin-top: 10px;font-size: 12px;color: #666;\">扩展存储支持自定义域名、阶梯计费，越用越便宜、功能更强大</text>\r\n\t\t\t\t\t\t<text class=\"uni-sub-title\" style=\"margin-top: 10px;font-size: 12px;color: #2979ff;cursor: pointer;text-decoration: underline; margin-left: 10px;\" @click=\"toUrl('https://doc.dcloud.net.cn/uniCloud/ext-storage/service.html')\">扩展存储开通文档</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</uni-forms-item>\r\n\r\n\t\t\t\t<uni-forms-item label=\"自定义域名\" v-if=\"uniFilePickerProvider === 'extStorage'\">\r\n\t\t\t\t\t<view class=\"flex\" style=\"flex-direction: column;align-items:flex-start;\">\r\n\t\t\t\t\t\t<uni-easyinput placeholder=\"请输入扩展存储自定义域名\" v-model=\"domain\" :maxlength=\"-1\" style=\"width: 550px;\"/>\r\n\t\t\t\t\t\t<text class=\"uni-sub-title\" style=\"margin-top: 10px;font-size: 12px;color: #666;\">输入扩展存储绑定的域名，在服务空间-云存储-扩展存储页面可查看，如：cdn.example.com</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</uni-forms-item>\r\n\r\n\t\t\t\t<uni-forms-item :label=\"'上传'+fileExtname[0]+'包'\">\r\n\t\t\t\t\t<uni-file-picker v-model=\"appFileList\" :file-extname=\"fileExtname\" :disabled=\"hasPackage\"\r\n\t\t\t\t\t\treturnType=\"object\" file-mediatype=\"all\" limit=\"1\" @success=\"packageUploadSuccess\" :provider=\"uniFilePickerProvider\"\r\n\t\t\t\t\t\t@delete=\"packageDelete\">\r\n\t\t\t\t\t\t<view class=\"flex\">\r\n\t\t\t\t\t\t\t<button type=\"primary\" size=\"mini\" @click=\"selectFile\" style=\"margin: 0px;\">选择文件</button>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</uni-file-picker>\r\n\t\t\t\t\t<text v-if=\"hasPackage\"\r\n\t\t\t\t\t\tstyle=\"padding-left: 20px;color: #a8a8a8;\">{{Number(appFileList.size / 1024 / 1024).toFixed(2)}}M</text>\r\n\t\t\t\t</uni-forms-item>\r\n\t\t\t</template>\r\n\r\n\t\t\t<uni-forms-item key=\"url\" name=\"url\" :label=\"urlLabel\" required>\r\n\t\t\t\t<view class=\"flex\" style=\"flex-direction: column;align-items:flex-start;flex: 1;\">\r\n\t\t\t\t\t<view class=\"flex\" style=\"width: 100%;\">\r\n\t\t\t\t\t\t<uni-easyinput :disabled=\"detailsState\" placeholder=\"下载链接\" v-model=\"formData.url\" :maxlength=\"-1\" />\r\n\t\t\t\t\t\t<text style=\"margin-left: 10px;color: #2979ff;cursor: pointer;text-decoration: underline;\" v-if=\"formData.url\" @click=\"toUrl(formData.url)\">测试下载</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<text style=\"margin-top: 10px;font-size: 12px;color: #666;\" v-if=\"formData.url && !detailsState\">建议点击【测试下载】能正常下载后，再进行发布</text>\r\n\t\t\t\t</view>\r\n\t\t\t</uni-forms-item>\r\n\r\n\t\t\t<uni-forms-item v-if=\"isAndroid && !isWGT && formData.store_list.length\" label=\"Android应用市场\" key=\"store_list\"\r\n\t\t\t\tname=\"store_list\" labelWidth=\"120\">\r\n\t\t\t\t<view style=\"flex: 1;\">\r\n\t\t\t\t\t<view v-for=\"(item,index) in formData.store_list\" :key=\"item.id\">\r\n\t\t\t\t\t\t<uni-card style=\"margin: 0px 0px 20px 0px;\">\r\n\t\t\t\t\t\t\t<view style=\"display: flex;\">\r\n\t\t\t\t\t\t\t\t<checkbox-group style=\"user-select: none;\"\r\n\t\t\t\t\t\t\t\t\t@change=\"({detail:{value}}) => {item.enable = !!value.length}\">\r\n\t\t\t\t\t\t\t\t\t<label class=\"title_padding\">\r\n\t\t\t\t\t\t\t\t\t\t<checkbox :disabled=\"detailsState\" value=\"scheme\" :checked=\"item.enable\" />\r\n\t\t\t\t\t\t\t\t\t\t<text>是否启用</text>\r\n\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t</checkbox-group>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<uni-forms-item label=\"商店名称\">\r\n\t\t\t\t\t\t\t\t<uni-easyinput disabled v-model=\"item.name\" trim=\"both\"></uni-easyinput>\r\n\t\t\t\t\t\t\t</uni-forms-item>\r\n\t\t\t\t\t\t\t<uni-forms-item label=\"Scheme\">\r\n\t\t\t\t\t\t\t\t<uni-easyinput disabled v-model=\"item.scheme\" trim=\"both\"></uni-easyinput>\r\n\t\t\t\t\t\t\t</uni-forms-item>\r\n\t\t\t\t\t\t\t<uni-forms-item label=\"优先级\">\r\n\t\t\t\t\t\t\t\t<uni-easyinput :disabled=\"detailsState\" v-model=\"item.priority\" type=\"number\">\r\n\t\t\t\t\t\t\t\t</uni-easyinput>\r\n\t\t\t\t\t\t\t\t<show-info :top=\"-100\" :left=\"-180\" :content=\"priorityContent\"></show-info>\r\n\t\t\t\t\t\t\t</uni-forms-item>\r\n\t\t\t\t\t\t</uni-card>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</uni-forms-item>\r\n\r\n\t\t\t<uni-forms-item v-if=\"isWGT\" key=\"is_silently\" name=\"is_silently\" label=\"静默更新\">\r\n\t\t\t\t<switch :disabled=\"detailsState\"\r\n\t\t\t\t\t@change=\"binddata('is_silently', $event.detail.value),formData.is_silently=$event.detail.value\"\r\n\t\t\t\t\t:checked=\"formData.is_silently\" />\r\n\t\t\t\t<show-info :top=\"-80\" :content=\"silentlyContent\"></show-info>\r\n\t\t\t</uni-forms-item>\r\n\t\t\t<uni-forms-item key=\"is_mandatory\" name=\"is_mandatory\" label=\"强制更新\">\r\n\t\t\t\t<switch :disabled=\"detailsState\"\r\n\t\t\t\t\t@change=\"binddata('is_mandatory', $event.detail.value),formData.is_mandatory=$event.detail.value\"\r\n\t\t\t\t\t:checked=\"formData.is_mandatory\" />\r\n\t\t\t\t<show-info width=\"230\" :top=\"-30\" :content=\"mandatoryContent\"></show-info>\r\n\t\t\t</uni-forms-item>\r\n\t\t\t<uni-forms-item name=\"stable_publish\" label=\"上线发行\">\r\n\t\t\t\t<switch :disabled=\"detailsState || isStable\"\r\n\t\t\t\t\t@change=\"binddata('stable_publish', $event.detail.value),formData.stable_publish=$event.detail.value\"\r\n\t\t\t\t\t:checked=\"formData.stable_publish\" />\r\n\t\t\t\t<show-info v-if=\"isStable\" :top=\"-50\" width=\"350\" :content=\"stablePublishContent\"></show-info>\r\n\t\t\t\t<show-info v-else :top=\"-40\" :content=\"stablePublishContent2\"></show-info>\r\n\t\t\t</uni-forms-item>\r\n\t\t\t<uni-forms-item name=\"create_date\" label=\"上传时间\">\r\n\t\t\t\t<uni-dateformat format=\"yyyy-MM-dd hh:mm:ss\" :date=\"formData.create_date\" :threshold=\"[0, 0]\" />\r\n\t\t\t</uni-forms-item>\r\n\t\t\t<uni-forms-item v-show=\"false\" name=\"type\" label=\"安装包类型\">\r\n\t\t\t\t<uni-data-checkbox v-model=\"formData.type\" :localdata=\"formOptions.type_localdata\" />\r\n\t\t\t</uni-forms-item>\r\n\t\t\t<view class=\"uni-button-group\">\r\n\t\t\t\t<button type=\"primary\" class=\"uni-button\" style=\"width: 100px;\" @click=\"detailsState = false\"\r\n\t\t\t\t\tv-if=\"detailsState\">修改</button>\r\n\t\t\t\t<button type=\"primary\" class=\"uni-button\" style=\"width: 100px;\" @click=\"submit\"\r\n\t\t\t\t\tv-if=\"!detailsState\">提交</button>\r\n\t\t\t\t<button type=\"warn\" class=\"uni-button\" style=\"width: 100px;\" @click=\"cancelEdit\"\r\n\t\t\t\t\tv-if=\"!detailsState\">取消</button>\r\n\t\t\t\t<navigator open-type=\"navigateBack\" style=\"margin-left: 15px;\">\r\n\t\t\t\t\t<button class=\"uni-button\" style=\"width: 100px;\">返回</button>\r\n\t\t\t\t</navigator>\r\n\t\t\t</view>\r\n\t\t</uni-forms>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport {\r\n\t\tvalidator,\r\n\t\tenumConverter\r\n\t} from '@/js_sdk/validator/opendb-app-versions.js';\r\n\timport addAndDetail, {\r\n\t\tfields, platform_iOS, platform_Android, platform_Harmony\r\n\t} from '../mixin/version_add_detail_mixin.js'\r\n\timport {\r\n\t\tdeepClone,\r\n\t\tappVersionListDbName\r\n\t} from '../utils.js'\r\n\r\n\tconst db = uniCloud.database();\r\n\tconst dbCmd = db.command;\r\n\tconst dbCollectionName = appVersionListDbName;\r\n\r\n\tfunction getValidator(fields) {\r\n\t\tlet reuslt = {}\r\n\t\tfor (let key in validator) {\r\n\t\t\tif (fields.includes(key)) {\r\n\t\t\t\treuslt[key] = validator[key]\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn reuslt\r\n\t}\r\n\r\n\texport default {\r\n\t\tmixins: [addAndDetail],\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tshowStableInfo: false,\r\n\t\t\t\tisStable: true, // 是否是线上发行版\r\n\t\t\t\toriginalData: {}, // 原始数据，用于恢复状态\r\n\t\t\t\tdetailsState: true, // 查看状态,\r\n\t\t\t\tuniFilePickerProvider: 'unicloud',\r\n\t\t\t\tdomain: \"\"\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync onLoad(e) {\r\n\t\t\tlet { domain, provider } = this.getCloudStorageConfig();\r\n\t\t\tif (domain) this.domain = domain;\r\n\t\t\tif (provider) this.uniFilePickerProvider = provider;\r\n\r\n\t\t\tconst id = e.id\r\n\t\t\tthis.formDataId = id\r\n\t\t\tawait this.getDetail(id)\r\n\t\t\tthis.isStable = this.formData.stable_publish;\r\n\t\t\tthis.latestStableData = await this.getLatestVersion();\r\n\t\t\tif (this.isWGT) {\r\n\t\t\t\tthis.rules.min_uni_version.rules.push({\r\n\t\t\t\t\t\"required\": true\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t},\r\n\t\tonUnload() {\r\n\t\t\t// 临时处理，后面会再优化\r\n\t\t\tthis.setCloudStorage({\r\n\t\t\t\tprovider: null\r\n\t\t\t});\r\n\t\t},\r\n\t\twatch: {\r\n\t\t\tdomain(val) {\r\n\t\t\t\tthis.setCloudStorage({\r\n\t\t\t\t\tdomain: val\r\n\t\t\t\t});\r\n\t\t\t\tif (this.formData.url) {\r\n\t\t\t\t\t// 替换 this.formData.url 内的域名\r\n\t\t\t\t\tif (!val) val = \"请输入自定义域名\"\r\n\t\t\t\t\tthis.formData.url = this.formData.url.replace(/^(https?:\\/\\/)[^\\/]+/, `$1${val}`);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tuniFilePickerProvider(val){\r\n\t\t\t\tthis.setCloudStorage({\r\n\t\t\t\t\tprovider: val\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t/**\r\n\t\t\t * 触发表单提交\r\n\t\t\t */\r\n\t\t\tsubmit() {\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\tmask: true\r\n\t\t\t\t})\r\n\t\t\t\tthis.$refs.form.validate(['store_list']).then((res) => {\r\n\t\t\t\t\tif (res.store_list) {\r\n\t\t\t\t\t\tres.store_list.forEach(item => {\r\n\t\t\t\t\t\t\titem.priority = parseFloat(item.priority)\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.submitForm(res)\r\n\t\t\t\t}).catch((errors) => {\r\n\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tasync submitForm(value) {\r\n\t\t\t\tconst collectionDB = db.collection(dbCollectionName)\r\n\t\t\t\t// 使用 clientDB 提交数据\r\n\t\t\t\tcollectionDB.doc(this.formDataId).update(value).then(async (res) => {\r\n\t\t\t\t\t// 如果不是线上发行版，则在设置为上线发行时，需将之前的已上线版设为下线\r\n\t\t\t\t\tif (!this.isStable && value.stable_publish === true && this.latestStableData) {\r\n\t\t\t\t\t\tawait collectionDB.doc(this.latestStableData._id).update({\r\n\t\t\t\t\t\t\tstable_publish: false\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '修改成功'\r\n\t\t\t\t\t})\r\n\r\n\t\t\t\t\tthis.getOpenerEventChannel().emit('refreshData')\r\n\t\t\t\t\tsetTimeout(() => uni.navigateBack(), 500)\r\n\t\t\t\t}).catch((err) => {\r\n\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\tcontent: err.message || '请求服务失败',\r\n\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t})\r\n\t\t\t\t}).finally(() => {\r\n\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * 获取表单数据\r\n\t\t\t * @param {Object} id\r\n\t\t\t */\r\n\t\t\tgetDetail(id) {\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\tmask: true\r\n\t\t\t\t})\r\n\t\t\t\treturn db.collection(dbCollectionName)\r\n\t\t\t\t\t.doc(id)\r\n\t\t\t\t\t.field(fields)\r\n\t\t\t\t\t.get()\r\n\t\t\t\t\t.then((res) => {\r\n\t\t\t\t\t\tconst data = res.result.data[0]\r\n\t\t\t\t\t\tif (data) {\r\n\t\t\t\t\t\t\tif (!data.store_list) data.store_list = []\r\n\t\t\t\t\t\t\tthis.formData = data\r\n\t\t\t\t\t\t\tthis.originalData = deepClone(this.formData)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}).catch((err) => {\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\tcontent: err.message || '请求服务失败',\r\n\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}).finally(() => {\r\n\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tdeletePackage() {\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\tcontent: '是否删除该版本',\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\tuni.showLoading({\r\n\t\t\t\t\t\t\t\tmask: true\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\tdb.collection(dbCollectionName).doc(this.formDataId).remove()\r\n\t\t\t\t\t\t\t\t.then(() => {\r\n\t\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\t\ttitle: '删除成功'\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\tthis.getOpenerEventChannel().emit('refreshData')\r\n\t\t\t\t\t\t\t\t\tsetTimeout(() => uni.navigateBack(), 500)\r\n\t\t\t\t\t\t\t\t}).catch((err) => {\r\n\t\t\t\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\t\t\t\tcontent: err.message || '请求服务失败',\r\n\t\t\t\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t}).finally(() => {\r\n\t\t\t\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tasync getLatestVersion() {\r\n\t\t\t\tconst where = {\r\n\t\t\t\t\tappid: this.formData.appid,\r\n\t\t\t\t\ttype: this.formData.type,\r\n\t\t\t\t\tstable_publish: true\r\n\t\t\t\t};\r\n\t\t\t\tif (!this.isWGT) {\r\n\t\t\t\t\twhere.platform = this.formData.platform[0]\r\n\t\t\t\t}\r\n\t\t\t\tconst latestStableData = await db.collection(dbCollectionName).where(where).get()\r\n\t\t\t\treturn latestStableData.result.data.find(item => item.platform.toString() === this.formData.platform\r\n\t\t\t\t\t.toString());\r\n\t\t\t},\r\n\t\t\tcancelEdit() {\r\n\t\t\t\tlet content = '';\r\n\t\t\t\t!this.isiOS && this.hasPackage ? content += '\\n将会删除已上传的包' : '';\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: '取消修改',\r\n\t\t\t\t\tcontent,\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\tthis.formData = deepClone(this.originalData)\r\n\t\t\t\t\t\t\tthis.detailsState = true\r\n\r\n\t\t\t\t\t\t\tif (this.hasPackage) {\r\n\t\t\t\t\t\t\t\tthis.deleteFile([this.appFileList.url])\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n<style lang=\"scss\">\r\n\t.show-stable-info {\r\n\t\tposition: absolute;\r\n\t\tleft: 165px;\r\n\t\tpadding: 5px 10px;\r\n\t\tbackground-color: #f4f4f5;\r\n\t\tcolor: #909399;\r\n\t\tborder-radius: 4px;\r\n\t\tborder: 1px solid #e9e9eb;\r\n\t}\r\n\r\n\t::v-deep .uni-forms-item__content {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t}\r\n\r\n\t.uni-button-group {\r\n\t\t& button {\r\n\t\t\tmargin-left: 15px;\r\n\t\t}\r\n\r\n\t\t& button:first-child {\r\n\t\t\tmargin-left: 0px;\r\n\t\t}\r\n\t}\r\n</style>\r\n","import MiniProgramPage from 'E:/testProjects/WeChatProjects/testProject-2/燃气后台管理面板/uni_modules/uni-upgrade-center/pages/version/detail.vue'\nwx.createPage(MiniProgramPage)"],"names":["uniCloud","appVersionListDbName","addAndDetail","uni","fields","deepClone"],"mappings":"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"}