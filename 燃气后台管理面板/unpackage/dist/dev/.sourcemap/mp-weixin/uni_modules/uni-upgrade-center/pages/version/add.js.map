{"version":3,"file":"add.js","sources":["uni_modules/uni-upgrade-center/pages/version/add.vue","../../../../微信开发者工具/HBuilderX/plugins/uniapp-cli-vite/uniPage:/dW5pX21vZHVsZXMvdW5pLXVwZ3JhZGUtY2VudGVyL3BhZ2VzL3ZlcnNpb24vYWRkLnZ1ZQ"],"sourcesContent":["<template>\r\n\t<view class=\"uni-container\">\r\n\t\t<view class=\"uni-header\">\r\n\t\t\t<view class=\"uni-group\">\r\n\t\t\t\t<view class=\"uni-title\">包类型</view>\r\n\t\t\t\t<view class=\"uni-sub-title\">{{type_valuetotext[formData.type]}}</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<uni-forms ref=\"form\" :value=\"formData\" validateTrigger=\"bind\" :labelWidth=\"labelWidth\">\r\n\t\t\t<!-- region 基础信息 -->\r\n\t\t\t<uni-forms-item name=\"appid\" label=\"AppID\" required>\r\n\t\t\t\t<uni-easyinput :disabled=\"true\" v-model=\"formData.appid\" trim=\"both\" />\r\n\t\t\t</uni-forms-item>\r\n\t\t\t<uni-forms-item name=\"name\" label=\"应用名称\">\r\n\t\t\t\t<uni-easyinput :disabled=\"true\" v-model=\"formData.name\" trim=\"both\" />\r\n\t\t\t</uni-forms-item>\r\n\t\t\t<uni-forms-item name=\"title\" label=\"更新标题\">\r\n\t\t\t\t<uni-easyinput placeholder=\"更新标题\" v-model=\"formData.title\" />\r\n\t\t\t</uni-forms-item>\r\n\t\t\t<uni-forms-item name=\"contents\" label=\"更新内容\" required>\r\n\t\t\t\t<textarea auto-height style=\"box-sizing: content-box;\" :maxlength=\"-1\"  placeholder=\"更新内容 (可换行)\"\r\n\t\t\t\t\t@input=\"binddata('contents', $event.detail.value)\" class=\"uni-textarea-border\"\r\n\t\t\t\t\t:value=\"formData.contents\" @update:value=\"val => formData.contents = val\"></textarea>\r\n\t\t\t</uni-forms-item>\r\n\t\t\t<uni-forms-item name=\"platform\" label=\"平台\" required>\r\n\t\t\t\t<uni-data-checkbox :multiple=\"isWGT\" v-model=\"formData.platform\" :localdata=\"platformLocaldata\" />\r\n\t\t\t</uni-forms-item>\r\n\t\t\t<uni-forms-item name=\"version\" label=\"版本号\" required>\r\n\t\t\t\t<uni-easyinput v-model=\"formData.version\" placeholder=\"当前包版本号，必须大于当前线上发行版本号\" />\r\n\t\t\t</uni-forms-item>\r\n\t\t\t<!-- endregion -->\r\n\t\t\t<uni-forms-item v-if=\"isWGT\" key=\"min_uni_version\" name=\"min_uni_version\" label=\"原生App最低版本\"\r\n\t\t\t\t:required=\"isWGT\">\r\n\t\t\t\t<uni-easyinput placeholder=\"原生App最低版本\" v-model=\"formData.min_uni_version\" />\r\n\t\t\t\t<show-info :content=\"minUniVersionContent\"></show-info>\r\n\t\t\t</uni-forms-item>\r\n\r\n\t\t\t<template v-if=\"enableUploadPackage\">\r\n\t\t\t\t<uni-forms-item label=\"存储选择\">\r\n\t\t\t\t\t<view class=\"flex\">\r\n\t\t\t\t\t\t<radio-group @change=\"e => uniFilePickerProvider = e.detail.value\" style=\"width: 100%;\">\r\n\t\t\t\t\t\t\t<view class=\"flex\" style=\"flex-wrap: nowrap;\">\r\n\t\t\t\t\t\t上传至：\r\n\t\t\t\t\t\t\t\t<label>\r\n\t\t\t\t\t\t\t\t\t<radio value=\"unicloud\" :checked=\"uniFilePickerProvider === 'unicloud'\"/><text>内置存储</text>\r\n\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t<label style=\"margin-left: 20rpx;\">\r\n\t\t\t\t\t\t\t\t\t<radio value=\"extStorage\" :checked=\"uniFilePickerProvider === 'extStorage'\"/><text>扩展存储</text>\r\n\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</radio-group>\r\n\t\t\t\t\t\t<text class=\"uni-sub-title\" style=\"margin-top: 10px;font-size: 12px;color: #666;width: 100%;\">内置存储是服务空间开通后自带的云存储，不支持自定义域名，不支持阶梯计费</text>\r\n\t\t\t\t\t\t<text class=\"uni-sub-title\" style=\"margin-top: 10px;font-size: 12px;color: #666;\">扩展存储支持自定义域名、阶梯计费，越用越便宜、功能更强大</text>\r\n\t\t\t\t\t\t<text class=\"uni-sub-title\" style=\"margin-top: 10px;font-size: 12px;color: #2979ff;cursor: pointer;text-decoration: underline; margin-left: 10px;\" @click=\"toUrl('https://doc.dcloud.net.cn/uniCloud/ext-storage/service.html')\">扩展存储开通文档</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</uni-forms-item>\r\n\r\n\t\t\t\t<uni-forms-item label=\"自定义域名\" v-if=\"uniFilePickerProvider === 'extStorage'\">\r\n\t\t\t\t\t<view class=\"flex\" style=\"flex-direction: column;align-items:flex-start;\">\r\n\t\t\t\t\t\t<uni-easyinput placeholder=\"请输入扩展存储自定义域名\" v-model=\"domain\" :maxlength=\"-1\" style=\"width: 550px;\" />\r\n\t\t\t\t\t\t<text class=\"uni-sub-title\" style=\"margin-top: 10px;font-size: 12px;color: #666;\">输入扩展存储绑定的域名，在服务空间-云存储-扩展存储页面可查看，如：cdn.example.com</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</uni-forms-item>\r\n\r\n\t\t\t\t<uni-forms-item :label=\"'上传'+fileExtname[0]+'包'\">\r\n\t\t\t\t\t<uni-file-picker v-model=\"appFileList\" :file-extname=\"fileExtname\" :disabled=\"hasPackage\"\r\n\t\t\t\t\t\treturnType=\"object\" file-mediatype=\"all\" limit=\"1\" @success=\"packageUploadSuccess\" :provider=\"uniFilePickerProvider\"\r\n\t\t\t\t\t\t@delete=\"packageDelete\">\r\n\t\t\t\t\t\t<view class=\"flex\">\r\n\t\t\t\t\t\t\t<button type=\"primary\" size=\"mini\" @click=\"selectFile\" style=\"margin: 0px;\">选择文件</button>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"flex\">\r\n\t\t\t\t\t\t\t<text style=\"margin-top: 10px;font-size: 12px;color: #666;\">上传{{fileExtname[0]}}到当前服务空间的云存储中，上传成功后，会自动使用云存储地址填充下载链接</text>\r\n\t\t\t\t\t\t\t<text style=\"margin-top: 10px;font-size: 12px;color: #666;\">上传文件后同步到各地cdn缓存节点有延迟。请适当等候再提交新版信息入库，触发客户端更新提示。</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</uni-file-picker>\r\n\t\t\t\t\t<text v-if=\"hasPackage\" style=\"padding-left: 20px;color: #a8a8a8;\">{{Number(appFileList.size / 1024 / 1024).toFixed(2)}}M</text>\r\n\t\t\t\t</uni-forms-item>\r\n\t\t\t</template>\r\n\r\n\t\t\t<uni-forms-item key=\"url\" name=\"url\" :label=\"urlLabel\" required>\r\n\t\t\t\t<view class=\"flex\" style=\"flex-direction: column;align-items:flex-start;flex: 1;\">\r\n\t\t\t\t\t<view class=\"flex\" style=\"width: 100%;\">\r\n\t\t\t\t\t\t<uni-easyinput placeholder=\"链接\" v-model=\"formData.url\" :maxlength=\"-1\" />\r\n\t\t\t\t\t\t<text style=\"margin-left: 10px;color: #2979ff;cursor: pointer;text-decoration: underline;\" v-if=\"isApk\" @click=\"toUrl(formData.url)\">测试下载</text>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t\t<text style=\"margin-top: 10px;font-size: 12px;color: #666;\" v-if=\"isApk\">建议点击【测试下载】能正常下载后，再进行发布</text>\r\n\t\t\t\t</view>\r\n\t\t\t</uni-forms-item>\r\n\r\n\t\t\t<uni-forms-item v-if=\"isAndroid && !isWGT && formData.store_list.length\" label=\"Android应用市场\" labelWidth=\"125px\"\r\n\t\t\t\tkey=\"store_list\" name=\"store_list\">\r\n\t\t\t\t<view style=\"flex: 1;\">\r\n\t\t\t\t\t<view v-for=\"(item) in formData.store_list\" :key=\"item.id\">\r\n\t\t\t\t\t\t<uni-card style=\"margin: 0px 0px 20px 0px;\">\r\n\t\t\t\t\t\t\t<view style=\"display: flex;\">\r\n\t\t\t\t\t\t\t\t<checkbox-group style=\"user-select: none;\"\r\n\t\t\t\t\t\t\t\t\t@change=\"({detail:{value}}) => {item.enable = !!value.length}\">\r\n\t\t\t\t\t\t\t\t\t<label class=\"title_padding\">\r\n\t\t\t\t\t\t\t\t\t\t<checkbox value=\"scheme\" :checked=\"item.enable\" />\r\n\t\t\t\t\t\t\t\t\t\t<text>是否启用</text>\r\n\t\t\t\t\t\t\t\t\t</label>\r\n\t\t\t\t\t\t\t\t</checkbox-group>\r\n\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t<uni-forms-item label=\"商店名称\">\r\n\t\t\t\t\t\t\t\t<uni-easyinput disabled v-model=\"item.name\" trim=\"both\"></uni-easyinput>\r\n\t\t\t\t\t\t\t</uni-forms-item>\r\n\t\t\t\t\t\t\t<uni-forms-item label=\"Scheme\">\r\n\t\t\t\t\t\t\t\t<uni-easyinput disabled v-model=\"item.scheme\" trim=\"both\"></uni-easyinput>\r\n\t\t\t\t\t\t\t</uni-forms-item>\r\n\t\t\t\t\t\t\t<uni-forms-item label=\"优先级\">\r\n\t\t\t\t\t\t\t\t<uni-easyinput v-model=\"item.priority\" type=\"number\"></uni-easyinput>\r\n\t\t\t\t\t\t\t\t<show-info :top=\"-100\" :left=\"-180\" :content=\"priorityContent\"></show-info>\r\n\t\t\t\t\t\t\t</uni-forms-item>\r\n\t\t\t\t\t\t</uni-card>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</uni-forms-item>\r\n\t\t\t<uni-forms-item v-if=\"isWGT\" key=\"is_silently\" name=\"is_silently\" label=\"静默更新\">\r\n\t\t\t\t<switch @change=\"binddata('is_silently', $event.detail.value)\" :checked=\"formData.is_silently\" />\r\n\t\t\t\t<show-info :top=\"-80\" :content=\"silentlyContent\"></show-info>\r\n\t\t\t</uni-forms-item>\r\n\t\t\t<uni-forms-item key=\"is_mandatory\" name=\"is_mandatory\" label=\"强制更新\">\r\n\t\t\t\t<switch @change=\"binddata('is_mandatory', $event.detail.value)\" :checked=\"formData.is_mandatory\" />\r\n\t\t\t\t<show-info :content=\"mandatoryContent\"></show-info>\r\n\t\t\t</uni-forms-item>\r\n\t\t\t<uni-forms-item name=\"stable_publish\" label=\"上线发行\">\r\n\t\t\t\t<switch @change=\"binddata('stable_publish', $event.detail.value)\" :checked=\"formData.stable_publish\" />\r\n\t\t\t\t<show-info :top=\"-40\" :content=\"stablePublishContent2\"></show-info>\r\n\t\t\t</uni-forms-item>\r\n\t\t\t<uni-forms-item v-show=\"false\" name=\"type\" label=\"安装包类型\">\r\n\t\t\t\t<uni-data-checkbox v-model=\"formData.type\" :localdata=\"formOptions.type_localdata\" />\r\n\t\t\t</uni-forms-item>\r\n\t\t\t<view class=\"uni-button-group\">\r\n\t\t\t\t<button type=\"primary\" class=\"uni-button\" style=\"width: 100px;\" @click=\"submit\">发布</button>\r\n\t\t\t\t<button type=\"warn\" class=\"uni-button\" style=\"width: 100px;margin-left: 15px;\" @click=\"back\">取消</button>\r\n\t\t\t</view>\r\n\t\t</uni-forms>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport {\r\n\t\tvalidator,\r\n\t\tenumConverter\r\n\t} from '@/js_sdk/validator/opendb-app-versions.js';\r\n\timport addAndDetail, {\r\n\t\tfields, platform_iOS, platform_Android, platform_Harmony\r\n\t} from '../mixin/version_add_detail_mixin.js';\r\n\timport {\r\n\t\tappVersionListDbName, compare\r\n\t} from '../utils.js';\r\n\r\n\tconst db = uniCloud.database();\r\n\tconst dbCmd = db.command;\r\n\tconst dbCollectionName = appVersionListDbName;\r\n\r\n\texport default {\r\n\t\tmixins: [addAndDetail],\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tlatestVersion: '0.0.0',\r\n\t\t\t\tlastVersionId: '',\r\n\t\t\t\tuniFilePickerProvider: 'unicloud',\r\n\t\t\t\tdomain: \"\"\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync onLoad({\r\n\t\t\tappid,\r\n\t\t\tname,\r\n\t\t\ttype\r\n\t\t}) {\r\n\t\t\tlet { domain, provider } = this.getCloudStorageConfig();\r\n\t\t\tif (domain) this.domain = domain;\r\n\t\t\tif (provider) this.uniFilePickerProvider = provider;\r\n\r\n\t\t\tif (appid && type && name) {\r\n\t\t\t\tconst store_list = await this.getStoreList(appid)\r\n\t\t\t\tthis.formData = {\r\n\t\t\t\t\t...this.formData,\r\n\t\t\t\t\t...{\r\n\t\t\t\t\t\tappid,\r\n\t\t\t\t\t\tname,\r\n\t\t\t\t\t\ttype,\r\n\t\t\t\t\t\tstore_list,\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tthis.latestStableData = await this.getDetail(appid, type)\r\n\t\t\t\t// 如果有数据，否则为发布第一版，默认为Android\r\n\t\t\t\tif (!this.isWGT && this.latestStableData.length) {\r\n\t\t\t\t\tthis.setFormData(platform_Android)\r\n\t\t\t\t}\r\n\t\t\t\t// 如果是wgt ，则需要将 min_uni_version 设为必填\r\n\t\t\t\tif (this.isWGT) {\r\n\t\t\t\t\tthis.rules.min_uni_version.rules.push({\r\n\t\t\t\t\t\t\"required\": true\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tonUnload() {\r\n\t\t\t// 临时处理，后面会再优化\r\n\t\t\tthis.setCloudStorage({\r\n\t\t\t\tprovider: null\r\n\t\t\t});\r\n\t\t},\r\n\t\twatch: {\r\n\t\t\tisiOS(val) {\r\n\t\t\t\tif (!val && this.hasPackage) {\r\n\t\t\t\t\tthis.formData.url = this.appFileList.url\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tthis.formData.url = ''\r\n\t\t\t},\r\n\t\t\t\"formData.platform\"(val) {\r\n\t\t\t\tthis.setFormData(val)\r\n\t\t\t},\r\n\t\t\t\"domain\"(val) {\r\n\t\t\t\tthis.setCloudStorage({\r\n\t\t\t\t\tdomain: val\r\n\t\t\t\t});\r\n\t\t\t\tif (this.formData.url) {\r\n\t\t\t\t\t// 替换 this.formData.url 内的域名\r\n\t\t\t\t\tif (!val) val = \"请输入自定义域名\"\r\n\t\t\t\t\tthis.formData.url = this.formData.url.replace(/^(https?:\\/\\/)[^\\/]+/, `$1${val}`);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tuniFilePickerProvider:{\r\n\t\t\t\timmediate: true,\r\n\t\t\t\thandler(val){\r\n\t\t\t\t\tthis.setCloudStorage({\r\n\t\t\t\t\t\tprovider: val\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tsetFormData(os) {\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\tmask: true\r\n\t\t\t\t})\r\n\t\t\t\t// 每次需初始化 版本 与 id ，因为可能是新增第一版\r\n\t\t\t\tthis.latestVersion = '0.0.0';\r\n\t\t\t\tthis.lastVersionId = ''\r\n\r\n\t\t\t\tconst data = this.getData(this.latestStableData, os)[0]\r\n\r\n\t\t\t\tif (data) {\r\n\t\t\t\t\tconst {\r\n\t\t\t\t\t\t_id,\r\n\t\t\t\t\t\tversion,\r\n\t\t\t\t\t\tname,\r\n\t\t\t\t\t\tplatform,\r\n\t\t\t\t\t\tmin_uni_version,\r\n\t\t\t\t\t\turl\r\n\t\t\t\t\t} = data\r\n\r\n\t\t\t\t\tthis.lastVersionId = _id\r\n\t\t\t\t\tthis.latestVersion = version;\r\n\r\n\t\t\t\t\tthis.formData.name = name\r\n\r\n\t\t\t\t\t// 如果不是wgt，则需要删除 min_uni_version 字段\r\n\t\t\t\t\tif (!this.isWGT) {\r\n\t\t\t\t\t\tdelete this.formData.min_uni_version;\r\n\t\t\t\t\t\tthis.formData.platform = platform[0]\r\n\r\n\t\t\t\t\t\t// iOS需要带出上一版本的AppStore链接\r\n\t\t\t\t\t\tif (this.isiOS || this.isHarmony) {\r\n\t\t\t\t\t\t\tthis.formData.url = url;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.formData.min_uni_version = min_uni_version\r\n\t\t\t\t\t\t// this.formData.platform = [os]\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (this.isWGT) {\r\n\t\t\t\t\tthis.formData.min_uni_version = ''\r\n\t\t\t\t}\r\n\t\t\t\tuni.hideLoading()\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * 触发表单提交\r\n\t\t\t */\r\n\t\t\tsubmit() {\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\tmask: true\r\n\t\t\t\t})\r\n\t\t\t\tthis.$refs.form.validate(['store_list']).then((res) => {\r\n\t\t\t\t\tif (compare(this.latestVersion, res.version) >= 0) {\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\tcontent: `版本号必须大于当前已上线版本（${this.latestVersion}）`,\r\n\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\tthrow new Error('版本号必须大于已上线版本（${this.latestVersion}）');\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// 如果不是 wgt 更新，则需将 platform 字段还原为 array\r\n\t\t\t\t\tif (!this.isWGT) {\r\n\t\t\t\t\t\tres.platform = [res.platform]\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (this.isiOS || this.isHarmony || this.isWGT) delete res.store_list;\r\n\t\t\t\t\tif (res.store_list) {\r\n\t\t\t\t\t\tres.store_list.forEach(item => {\r\n\t\t\t\t\t\t\titem.priority = parseFloat(item.priority)\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.submitForm(res)\r\n\t\t\t\t}).catch((errors) => {\r\n\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tasync submitForm(value) {\r\n\t\t\t\tvalue = this.createCenterRecord(value)\r\n\t\t\t\tconst collectionDB = db.collection(dbCollectionName)\r\n\t\t\t\t// uni-stat 会创建这些字段 appid\r\n\t\t\t\tlet recordCreateByUniStat = []\r\n\t\t\t\tif (!this.isWGT) {\r\n\t\t\t\t\trecordCreateByUniStat = await this.getDetail(value.appid, value.type, this.createStatQuery(value))\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet dbOperate\r\n\t\t\t\tif (!recordCreateByUniStat.length) {\r\n\t\t\t\t\tdbOperate = collectionDB.add(value)\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvalue.create_date = Date.now()\r\n\t\t\t\t\tdbOperate = collectionDB.doc(recordCreateByUniStat[0]._id).update(value)\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// 使用 clientDB 提交数据\r\n\t\t\t\tdbOperate.then(async (res) => {\r\n\t\t\t\t\t// 如果新增版本为上线发行，且之前有该平台的上线发行，则自动将上一版设为下线\r\n\t\t\t\t\tif (value.stable_publish && this.lastVersionId) {\r\n\t\t\t\t\t\tawait collectionDB.doc(this.lastVersionId).update({\r\n\t\t\t\t\t\t\tstable_publish: false\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\ttitle: '新增成功'\r\n\t\t\t\t\t})\r\n\t\t\t\t\tthis.getOpenerEventChannel().emit('refreshData')\r\n\t\t\t\t\tsetTimeout(() => uni.navigateBack(), 500)\r\n\t\t\t\t}).catch((err) => {\r\n\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\tcontent: err.message || '请求服务失败',\r\n\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t})\r\n\t\t\t\t}).finally(() => {\r\n\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t})\r\n\r\n\t\t\t\tthis.setCloudStorageConfig({\r\n\t\t\t\t\tprovider: this.uniFilePickerProvider,\r\n\t\t\t\t\tdomain: this.domain,\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t/**\r\n\t\t\t * 获取表单数据\r\n\t\t\t * @param {Object} id\r\n\t\t\t */\r\n\t\t\tgetDetail(appid, type, args = {}) {\r\n\t\t\t\tuni.showLoading({\r\n\t\t\t\t\tmask: true\r\n\t\t\t\t})\r\n\t\t\t\treturn db.collection(dbCollectionName)\r\n\t\t\t\t\t.where(\r\n\t\t\t\t\t\tObject.assign({\r\n\t\t\t\t\t\t\tappid,\r\n\t\t\t\t\t\t\ttype,\r\n\t\t\t\t\t\t\tstable_publish: true\r\n\t\t\t\t\t\t}, args)\r\n\t\t\t\t\t)\r\n\t\t\t\t\t.field(fields)\r\n\t\t\t\t\t.get()\r\n\t\t\t\t\t.then((res) => res.result.data)\r\n\t\t\t\t\t.catch((err) => {\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\tcontent: err.message || '请求服务失败',\r\n\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}).finally(() => {\r\n\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tgetData(data = [], platform) {\r\n\t\t\t\tif (typeof platform === 'string') {\r\n\t\t\t\t\treturn data.filter(item => item.platform.includes(platform))\r\n\t\t\t\t} else {\r\n\t\t\t\t\treturn data.filter(item => item.platform.toString() === platform.toString())\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tback() {\r\n\t\t\t\tuni.showModal({\r\n\t\t\t\t\ttitle: '取消发布',\r\n\t\t\t\t\tcontent: this.hasPackage ? '将会删除已上传的包' : undefined,\r\n\t\t\t\t\tsuccess: res => {\r\n\t\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\t\t// 若已上传包但取消发布，则自动将包删除\r\n\t\t\t\t\t\t\tif (this.hasPackage) {\r\n\t\t\t\t\t\t\t\tthis.deleteFile([this.appFileList.url])\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tuni.navigateBack()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n\t::v-deep .uni-forms-item__content {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t}\r\n\r\n\t.uni-button-group {\r\n\t\t& button {\r\n\t\t\tmargin-left: 15px;\r\n\t\t}\r\n\r\n\t\t& button:first-child {\r\n\t\t\tmargin-left: 0px;\r\n\t\t}\r\n\t}\r\n\r\n\t.title_padding {\r\n\t\tpadding-bottom: 15px;\r\n\t\tdisplay: block;\r\n\t}\r\n\r\n\t::v-deep .uni-file-picker__files {\r\n\t\tmax-width: 100%;\r\n\t}\r\n</style>\r\n","import MiniProgramPage from 'E:/testProjects/WeChatProjects/testProject-2/燃气后台管理面板/uni_modules/uni-upgrade-center/pages/version/add.vue'\nwx.createPage(MiniProgramPage)"],"names":["uniCloud","appVersionListDbName","addAndDetail","platform_Android","uni","compare","fields"],"mappings":";;;;AA0JC,MAAM,KAAKA,cAAAA,GAAS;AACN,GAAG;AACjB,MAAM,mBAAmBC,yCAAAA;AAEzB,MAAK,YAAU;AAAA,EACd,QAAQ,CAACC,kEAAAA,YAAY;AAAA,EACrB,OAAO;AACN,WAAO;AAAA,MACN,eAAe;AAAA,MACf,eAAe;AAAA,MACf,uBAAuB;AAAA,MACvB,QAAQ;AAAA,IACT;AAAA,EACA;AAAA,EACD,MAAM,OAAO;AAAA,IACZ;AAAA,IACA;AAAA,IACA;AAAA,EACD,GAAG;AACF,QAAI,EAAE,QAAQ,SAAS,IAAI,KAAK,sBAAqB;AACrD,QAAI;AAAQ,WAAK,SAAS;AAC1B,QAAI;AAAU,WAAK,wBAAwB;AAE3C,QAAI,SAAS,QAAQ,MAAM;AAC1B,YAAM,aAAa,MAAM,KAAK,aAAa,KAAK;AAChD,WAAK,WAAW;AAAA,QACf,GAAG,KAAK;AAAA,QACR,GAAG;AAAA,UACF;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,QACD;AAAA,MACD;AAEA,WAAK,mBAAmB,MAAM,KAAK,UAAU,OAAO,IAAI;AAExD,UAAI,CAAC,KAAK,SAAS,KAAK,iBAAiB,QAAQ;AAChD,aAAK,YAAYC,kFAAgB;AAAA,MAClC;AAEA,UAAI,KAAK,OAAO;AACf,aAAK,MAAM,gBAAgB,MAAM,KAAK;AAAA,UACrC,YAAY;AAAA,SACZ;AAAA,MACF;AAAA,IACD;AAAA,EACA;AAAA,EACD,WAAW;AAEV,SAAK,gBAAgB;AAAA,MACpB,UAAU;AAAA,IACX,CAAC;AAAA,EACD;AAAA,EACD,OAAO;AAAA,IACN,MAAM,KAAK;AACV,UAAI,CAAC,OAAO,KAAK,YAAY;AAC5B,aAAK,SAAS,MAAM,KAAK,YAAY;AACrC;AAAA,MACD;AACA,WAAK,SAAS,MAAM;AAAA,IACpB;AAAA,IACD,oBAAoB,KAAK;AACxB,WAAK,YAAY,GAAG;AAAA,IACpB;AAAA,IACD,SAAS,KAAK;AACb,WAAK,gBAAgB;AAAA,QACpB,QAAQ;AAAA,MACT,CAAC;AACD,UAAI,KAAK,SAAS,KAAK;AAEtB,YAAI,CAAC;AAAK,gBAAM;AAChB,aAAK,SAAS,MAAM,KAAK,SAAS,IAAI,QAAQ,wBAAwB,KAAK,GAAG,EAAE;AAAA,MACjF;AAAA,IACA;AAAA,IACD,uBAAsB;AAAA,MACrB,WAAW;AAAA,MACX,QAAQ,KAAI;AACX,aAAK,gBAAgB;AAAA,UACpB,UAAU;AAAA,QACX,CAAC;AAAA,MACF;AAAA,IACD;AAAA,EACA;AAAA,EACD,SAAS;AAAA,IACR,YAAY,IAAI;AACfC,oBAAAA,MAAI,YAAY;AAAA,QACf,MAAM;AAAA,OACN;AAED,WAAK,gBAAgB;AACrB,WAAK,gBAAgB;AAErB,YAAM,OAAO,KAAK,QAAQ,KAAK,kBAAkB,EAAE,EAAE,CAAC;AAEtD,UAAI,MAAM;AACT,cAAM;AAAA,UACL;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,YACG;AAEJ,aAAK,gBAAgB;AACrB,aAAK,gBAAgB;AAErB,aAAK,SAAS,OAAO;AAGrB,YAAI,CAAC,KAAK,OAAO;AAChB,iBAAO,KAAK,SAAS;AACrB,eAAK,SAAS,WAAW,SAAS,CAAC;AAGnC,cAAI,KAAK,SAAS,KAAK,WAAW;AACjC,iBAAK,SAAS,MAAM;AAAA,UACrB;AAAA,eACM;AACN,eAAK,SAAS,kBAAkB;AAAA,QAEjC;AAAA,MACD,WAAW,KAAK,OAAO;AACtB,aAAK,SAAS,kBAAkB;AAAA,MACjC;AACAA,oBAAAA,MAAI,YAAY;AAAA,IAChB;AAAA;AAAA;AAAA;AAAA,IAID,SAAS;AACRA,oBAAAA,MAAI,YAAY;AAAA,QACf,MAAM;AAAA,OACN;AACD,WAAK,MAAM,KAAK,SAAS,CAAC,YAAY,CAAC,EAAE,KAAK,CAAC,QAAQ;AACtD,YAAIC,yCAAAA,QAAQ,KAAK,eAAe,IAAI,OAAO,KAAK,GAAG;AAClDD,wBAAAA,MAAI,UAAU;AAAA,YACb,SAAS,kBAAkB,KAAK,aAAa;AAAA,YAC7C,YAAY;AAAA,WACZ;AACD,gBAAM,IAAI,MAAM,qCAAqC;AAAA,QACtD;AAEA,YAAI,CAAC,KAAK,OAAO;AAChB,cAAI,WAAW,CAAC,IAAI,QAAQ;AAAA,QAC7B;AACA,YAAI,KAAK,SAAS,KAAK,aAAa,KAAK;AAAO,iBAAO,IAAI;AAC3D,YAAI,IAAI,YAAY;AACnB,cAAI,WAAW,QAAQ,UAAQ;AAC9B,iBAAK,WAAW,WAAW,KAAK,QAAQ;AAAA,WACxC;AAAA,QACF;AACA,aAAK,WAAW,GAAG;AAAA,MACpB,CAAC,EAAE,MAAM,CAAC,WAAW;AACpBA,sBAAAA,MAAI,YAAY;AAAA,OAChB;AAAA,IACD;AAAA,IACD,MAAM,WAAW,OAAO;AACvB,cAAQ,KAAK,mBAAmB,KAAK;AACrC,YAAM,eAAe,GAAG,WAAW,gBAAgB;AAEnD,UAAI,wBAAwB,CAAC;AAC7B,UAAI,CAAC,KAAK,OAAO;AAChB,gCAAwB,MAAM,KAAK,UAAU,MAAM,OAAO,MAAM,MAAM,KAAK,gBAAgB,KAAK,CAAC;AAAA,MAClG;AAEA,UAAI;AACJ,UAAI,CAAC,sBAAsB,QAAQ;AAClC,oBAAY,aAAa,IAAI,KAAK;AAAA,aAC5B;AACN,cAAM,cAAc,KAAK,IAAI;AAC7B,oBAAY,aAAa,IAAI,sBAAsB,CAAC,EAAE,GAAG,EAAE,OAAO,KAAK;AAAA,MACxE;AAGA,gBAAU,KAAK,OAAO,QAAQ;AAE7B,YAAI,MAAM,kBAAkB,KAAK,eAAe;AAC/C,gBAAM,aAAa,IAAI,KAAK,aAAa,EAAE,OAAO;AAAA,YACjD,gBAAgB;AAAA,WAChB;AAAA,QACF;AACAA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,SACP;AACD,aAAK,sBAAqB,EAAG,KAAK,aAAa;AAC/C,mBAAW,MAAMA,cAAAA,MAAI,aAAY,GAAI,GAAG;AAAA,MACzC,CAAC,EAAE,MAAM,CAAC,QAAQ;AACjBA,sBAAAA,MAAI,UAAU;AAAA,UACb,SAAS,IAAI,WAAW;AAAA,UACxB,YAAY;AAAA,SACZ;AAAA,MACF,CAAC,EAAE,QAAQ,MAAM;AAChBA,sBAAAA,MAAI,YAAY;AAAA,OAChB;AAED,WAAK,sBAAsB;AAAA,QAC1B,UAAU,KAAK;AAAA,QACf,QAAQ,KAAK;AAAA,MACd,CAAC;AAAA,IACD;AAAA;AAAA;AAAA;AAAA;AAAA,IAKD,UAAU,OAAO,MAAM,OAAO,CAAA,GAAI;AACjCA,oBAAAA,MAAI,YAAY;AAAA,QACf,MAAM;AAAA,OACN;AACD,aAAO,GAAG,WAAW,gBAAgB,EACnC;AAAA,QACA,OAAO,OAAO;AAAA,UACb;AAAA,UACA;AAAA,UACA,gBAAgB;AAAA,QAChB,GAAE,IAAI;AAAA,MACR,EACC,MAAME,kEAAAA,MAAM,EACZ,IAAI,EACJ,KAAK,CAAC,QAAQ,IAAI,OAAO,IAAI,EAC7B,MAAM,CAAC,QAAQ;AACfF,sBAAAA,MAAI,UAAU;AAAA,UACb,SAAS,IAAI,WAAW;AAAA,UACxB,YAAY;AAAA,SACZ;AAAA,MACF,CAAC,EAAE,QAAQ,MAAM;AAChBA,sBAAAA,MAAI,YAAY;AAAA,OAChB;AAAA,IACF;AAAA,IACD,QAAQ,OAAO,CAAE,GAAE,UAAU;AAC5B,UAAI,OAAO,aAAa,UAAU;AACjC,eAAO,KAAK,OAAO,UAAQ,KAAK,SAAS,SAAS,QAAQ,CAAC;AAAA,aACrD;AACN,eAAO,KAAK,OAAO,UAAQ,KAAK,SAAS,SAAS,MAAM,SAAS,UAAU;AAAA,MAC5E;AAAA,IACA;AAAA,IACD,OAAO;AACNA,oBAAAA,MAAI,UAAU;AAAA,QACb,OAAO;AAAA,QACP,SAAS,KAAK,aAAa,cAAc;AAAA,QACzC,SAAS,SAAO;AACf,cAAI,IAAI,SAAS;AAEhB,gBAAI,KAAK,YAAY;AACpB,mBAAK,WAAW,CAAC,KAAK,YAAY,GAAG,CAAC;AAAA,YACvC;AAEAA,0BAAAA,MAAI,aAAa;AAAA,UAClB;AAAA,QACD;AAAA,MACD,CAAC;AAAA,IACF;AAAA,EACD;AACD;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACvZD,GAAG,WAAW,eAAe;"}