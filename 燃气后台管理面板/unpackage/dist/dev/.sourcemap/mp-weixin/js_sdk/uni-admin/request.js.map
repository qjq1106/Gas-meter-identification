{"version":3,"file":"request.js","sources":["js_sdk/uni-admin/request.js"],"sourcesContent":["import store from '@/store/index.js'\r\nimport config from '@/admin.config.js'\r\nconst debugOptions = config.navBar.debug\r\n\r\nconst db = uniCloud.database()\r\n\r\nexport function request (action, params, options) {\r\n\tconst {objectName, functionName, showModal, ...objectOptions} = Object.assign({\r\n\t\tobjectName: 'uni-id-co',\r\n\t\tfunctionName: '',\r\n\t\tshowModal: false,\r\n\r\n\t\tcustomUI: true,\r\n\t\tloadingOptions: {\r\n\t\t\ttitle: 'xxx'\r\n\t\t},\r\n\t}, options)\r\n\r\n\t// 兼容 云函数 与 云对象 请求，默认为云对象\r\n\tlet call\r\n\tif (functionName) {\r\n\t\tcall = uniCloud.callFunction({\r\n\t\t\tname: functionName,\r\n\t\t\tdata: {\r\n\t\t\t\taction,\r\n\t\t\t\tparams\r\n\t\t\t}\r\n\t\t})\r\n\t} else {\r\n\t\tconst uniCloudObject = uniCloud.importObject(objectName, objectOptions)\r\n\t\tcall = uniCloudObject[action](params)\r\n\t}\r\n\r\n\treturn call.then(result => {\r\n\t\tresult = functionName ? result.result: result\r\n\t\tif (!result) {\r\n\t\t\treturn Promise.resolve(result)\r\n\t\t}\r\n\r\n\t\tif (result.errCode) {\r\n\t\t\treturn Promise.reject(result)\r\n\t\t}\r\n\r\n\t\treturn Promise.resolve(result)\r\n\r\n\t}).catch(err => {\r\n\t\tshowModal && uni.showModal({\r\n\t\t\tcontent: err.errMsg || '请求服务失败',\r\n\t\t\tshowCancel: false\r\n\t\t})\r\n\t\t// #ifdef H5\r\n\t\tconst noDebugPages = ['/uni_modules/uni-id-pages/pages/login/login-withpwd', '/uni_modules/uni-id-pages/pages/register/register']\r\n\t\tconst path = location.hash.split('#')[1]\r\n\t\tif (debugOptions && debugOptions.enable === true && noDebugPages.indexOf(path) === -1) {\r\n\t\t\tstore.dispatch('error/add', {\r\n\t\t\t\terr: err.toString(),\r\n\t\t\t\tinfo: '$request(\"' + action + '\")',\r\n\t\t\t\troute: '',\r\n\t\t\t\ttime: new Date().toLocaleTimeString()\r\n\t\t\t})\r\n\t\t}\r\n\t\t// #endif\r\n\t\treturn Promise.reject(err)\r\n\t})\r\n}\r\n\r\n// #ifndef VUE3\r\nexport function initRequest(Vue) {\r\n\tVue.prototype.$request = request\r\n}\r\n// #endif\r\n\r\n// #ifdef VUE3\r\nexport function initRequest(app) {\r\n\tapp.config.globalProperties.$request = request\r\n}\r\n// #endif\r\n"],"names":["uniCloud","uni"],"mappings":";;;AAIWA,cAAQ,GAAC,SAAU;AAEvB,SAAS,QAAS,QAAQ,QAAQ,SAAS;AACjD,QAAM,EAAC,YAAY,cAAc,WAAW,GAAG,cAAa,IAAI,OAAO,OAAO;AAAA,IAC7E,YAAY;AAAA,IACZ,cAAc;AAAA,IACd,WAAW;AAAA,IAEX,UAAU;AAAA,IACV,gBAAgB;AAAA,MACf,OAAO;AAAA,IACP;AAAA,EACD,GAAE,OAAO;AAGV,MAAI;AACJ,MAAI,cAAc;AACjB,WAAOA,cAAQ,GAAC,aAAa;AAAA,MAC5B,MAAM;AAAA,MACN,MAAM;AAAA,QACL;AAAA,QACA;AAAA,MACA;AAAA,IACJ,CAAG;AAAA,EACH,OAAQ;AACN,UAAM,iBAAiBA,cAAQ,GAAC,aAAa,YAAY,aAAa;AACtE,WAAO,eAAe,MAAM,EAAE,MAAM;AAAA,EACpC;AAED,SAAO,KAAK,KAAK,YAAU;AAC1B,aAAS,eAAe,OAAO,SAAQ;AACvC,QAAI,CAAC,QAAQ;AACZ,aAAO,QAAQ,QAAQ,MAAM;AAAA,IAC7B;AAED,QAAI,OAAO,SAAS;AACnB,aAAO,QAAQ,OAAO,MAAM;AAAA,IAC5B;AAED,WAAO,QAAQ,QAAQ,MAAM;AAAA,EAE/B,CAAE,EAAE,MAAM,SAAO;AACf,iBAAaC,cAAG,MAAC,UAAU;AAAA,MAC1B,SAAS,IAAI,UAAU;AAAA,MACvB,YAAY;AAAA,IACf,CAAG;AAaD,WAAO,QAAQ,OAAO,GAAG;AAAA,EAC3B,CAAE;AACF;AASO,SAAS,YAAY,KAAK;AAChC,MAAI,OAAO,iBAAiB,WAAW;AACxC;;"}