{"version":3,"file":"uni-pay-orders.js","sources":["js_sdk/validator/uni-pay-orders.js"],"sourcesContent":["// 表单校验规则由 schema2code 生成，不建议直接修改校验规则，而建议通过 schema2code 生成, 详情: https://uniapp.dcloud.net.cn/uniCloud/schema\r\n\r\n\r\nconst validator = {\r\n  \"user_id\": {\r\n    \"rules\": [\r\n      {\r\n        \"format\": \"string\"\r\n      }\r\n    ],\r\n    \"label\": \"用户ID\"\r\n  },\r\n  \"provider\": {\r\n    \"rules\": [\r\n      {\r\n        \"format\": \"string\"\r\n      },\r\n      {\r\n        \"range\": [\r\n          {\r\n            \"text\": \"微信支付\",\r\n            \"value\": \"wxpay\"\r\n          },\r\n          {\r\n            \"text\": \"支付宝\",\r\n            \"value\": \"alipay\"\r\n          },\r\n          {\r\n            \"text\": \"苹果应用内支付\",\r\n            \"value\": \"appleiap\"\r\n          }\r\n        ]\r\n      }\r\n    ],\r\n    \"label\": \"支付供应商\"\r\n  },\r\n  \"provider_pay_type\": {\r\n    \"rules\": [\r\n      {\r\n        \"format\": \"string\"\r\n      }\r\n    ],\r\n    \"label\": \"支付方式\"\r\n  },\r\n  \"uni_platform\": {\r\n    \"rules\": [\r\n      {\r\n        \"format\": \"string\"\r\n      }\r\n    ],\r\n    \"label\": \"应用平台\"\r\n  },\r\n  \"status\": {\r\n    \"rules\": [\r\n      {\r\n        \"format\": \"int\"\r\n      },\r\n      {\r\n        \"range\": [\r\n          {\r\n            \"text\": \"已关闭\",\r\n            \"value\": -1\r\n          },\r\n          {\r\n            \"text\": \"未支付\",\r\n            \"value\": 0\r\n          },\r\n          {\r\n            \"text\": \"已支付\",\r\n            \"value\": 1\r\n          },\r\n          {\r\n            \"text\": \"已部分退款\",\r\n            \"value\": 2\r\n          },\r\n          {\r\n            \"text\": \"已全额退款\",\r\n            \"value\": 3\r\n          }\r\n        ]\r\n      }\r\n    ],\r\n    \"defaultValue\": 0,\r\n    \"label\": \"订单状态\"\r\n  },\r\n  \"type\": {\r\n    \"rules\": [\r\n      {\r\n        \"format\": \"string\"\r\n      }\r\n    ],\r\n    \"label\": \"订单类型\"\r\n  },\r\n  \"order_no\": {\r\n    \"rules\": [\r\n      {\r\n        \"format\": \"string\"\r\n      },\r\n      {\r\n        \"minLength\": 20,\r\n        \"maxLength\": 28\r\n      }\r\n    ],\r\n    \"label\": \"业务系统订单号\"\r\n  },\r\n  \"out_trade_no\": {\r\n    \"rules\": [\r\n      {\r\n        \"format\": \"string\"\r\n      }\r\n    ],\r\n    \"label\": \"支付插件订单号\"\r\n  },\r\n  \"transaction_id\": {\r\n    \"rules\": [\r\n      {\r\n        \"format\": \"string\"\r\n      }\r\n    ],\r\n    \"label\": \"交易单号\"\r\n  },\r\n  \"device_id\": {\r\n    \"rules\": [\r\n      {\r\n        \"format\": \"string\"\r\n      }\r\n    ],\r\n    \"label\": \"设备ID\"\r\n  },\r\n  \"client_ip\": {\r\n    \"rules\": [\r\n      {\r\n        \"format\": \"string\"\r\n      }\r\n    ],\r\n    \"label\": \"客户端IP\"\r\n  },\r\n  \"openid\": {\r\n    \"rules\": [\r\n      {\r\n        \"format\": \"string\"\r\n      }\r\n    ],\r\n    \"label\": \"openid\"\r\n  },\r\n  \"description\": {\r\n    \"rules\": [\r\n      {\r\n        \"format\": \"string\"\r\n      }\r\n    ],\r\n    \"label\": \"支付描述\"\r\n  },\r\n  \"err_msg \": {\r\n    \"rules\": [\r\n      {\r\n        \"format\": \"string\"\r\n      }\r\n    ],\r\n    \"label\": \"支付失败原因\"\r\n  },\r\n  \"total_fee\": {\r\n    \"rules\": [\r\n      {\r\n        \"format\": \"int\"\r\n      }\r\n    ],\r\n    \"label\": \"订单总金额\"\r\n  },\r\n  \"refund_fee\": {\r\n    \"rules\": [\r\n      {\r\n        \"format\": \"int\"\r\n      }\r\n    ],\r\n    \"label\": \"订单总退款金额\"\r\n  },\r\n  \"refund_count\": {\r\n    \"rules\": [\r\n      {\r\n        \"format\": \"int\"\r\n      }\r\n    ],\r\n    \"label\": \"当前退款笔数\"\r\n  },\r\n  \"refund_list\": {\r\n    \"rules\": [\r\n      {\r\n        \"format\": \"array\"\r\n      }\r\n    ],\r\n    \"label\": \"退款详情\"\r\n  },\r\n  \"provider_appid\": {\r\n    \"rules\": [\r\n      {\r\n        \"format\": \"string\"\r\n      }\r\n    ],\r\n    \"label\": \"开放平台appid\"\r\n  },\r\n  \"appid\": {\r\n    \"rules\": [\r\n      {\r\n        \"format\": \"string\"\r\n      }\r\n    ],\r\n    \"label\": \"DCloud AppId\"\r\n  },\r\n  \"user_order_success\": {\r\n    \"rules\": [\r\n      {\r\n        \"format\": \"bool\"\r\n      }\r\n    ],\r\n    \"label\": \"回调状态\"\r\n  },\r\n  \"pay_date\": {\r\n    \"rules\": [\r\n      {\r\n        \"format\": \"timestamp\"\r\n      }\r\n    ],\r\n    \"label\": \"支付时间\"\r\n  },\r\n  \"notify_date\": {\r\n    \"rules\": [\r\n      {\r\n        \"format\": \"timestamp\"\r\n      }\r\n    ],\r\n    \"label\": \"异步通知时间\"\r\n  },\r\n  \"cancel_date\": {\r\n    \"rules\": [\r\n      {\r\n        \"format\": \"timestamp\"\r\n      }\r\n    ],\r\n    \"label\": \"取消时间\"\r\n  }\r\n}\r\n\r\nconst enumConverter = {\r\n  \"provider_valuetotext\": {\r\n    \"wxpay\": \"微信支付\",\r\n    \"alipay\": \"支付宝\",\r\n    \"appleiap\": \"苹果应用内支付\"\r\n  },\r\n  \"status_valuetotext\": {\r\n    \"0\": \"未支付\",\r\n    \"1\": \"已支付\",\r\n    \"2\": \"已部分退款\",\r\n    \"3\": \"已全额退款\",\r\n    \"-1\": \"已关闭\"\r\n  }\r\n}\r\n\r\nfunction filterToWhere(filter, command) {\r\n  let where = {}\r\n  for (let field in filter) {\r\n    let { type, value } = filter[field]\r\n    switch (type) {\r\n      case \"search\":\r\n        if (typeof value === 'string' && value.length) {\r\n          //where[field] = new RegExp(value)\r\n\t\t\t\t\twhere[field] = value\r\n        }\r\n        // if (typeof value === 'string' && value.length) {\r\n        // \tstr += `(${field} == '${value}' || /${value}/.test(${field}))`\r\n        // \twhere[field] = new RegExp(value)\r\n        // }\r\n        break;\r\n      case \"select\":\r\n        if (value.length) {\r\n          let selectValue = []\r\n          for (let s of value) {\r\n            selectValue.push(command.eq(s))\r\n          }\r\n          where[field] = command.or(selectValue)\r\n        }\r\n        break;\r\n      case \"range\":\r\n        if (value.length) {\r\n          let gt = value[0]\r\n          let lt = value[1]\r\n          where[field] = command.and([command.gte(gt), command.lte(lt)])\r\n        }\r\n        break;\r\n      case \"date\":\r\n        if (value.length) {\r\n          let [s, e] = value\r\n          let startDate = new Date(s)\r\n          let endDate = new Date(e)\r\n          where[field] = command.and([command.gte(startDate), command.lte(endDate)])\r\n        }\r\n        break;\r\n      case \"timestamp\":\r\n        if (value.length) {\r\n          let [startDate, endDate] = value\r\n          where[field] = command.and([command.gte(startDate), command.lte(endDate)])\r\n        }\r\n        break;\r\n    }\r\n  }\r\n  return where\r\n}\r\n\r\nexport { validator, enumConverter, filterToWhere }\r\n"],"names":[],"mappings":";AAmPK,MAAC,gBAAgB;AAAA,EACpB,wBAAwB;AAAA,IACtB,SAAS;AAAA,IACT,UAAU;AAAA,IACV,YAAY;AAAA,EACb;AAAA,EACD,sBAAsB;AAAA,IACpB,KAAK;AAAA,IACL,KAAK;AAAA,IACL,KAAK;AAAA,IACL,KAAK;AAAA,IACL,MAAM;AAAA,EACP;AACH;AAEA,SAAS,cAAc,QAAQ,SAAS;AACtC,MAAI,QAAQ,CAAE;AACd,WAAS,SAAS,QAAQ;AACxB,QAAI,EAAE,MAAM,UAAU,OAAO,KAAK;AAClC,YAAQ,MAAI;AAAA,MACV,KAAK;AACH,YAAI,OAAO,UAAU,YAAY,MAAM,QAAQ;AAElD,gBAAM,KAAK,IAAI;AAAA,QACX;AAKD;AAAA,MACF,KAAK;AACH,YAAI,MAAM,QAAQ;AAChB,cAAI,cAAc,CAAE;AACpB,mBAAS,KAAK,OAAO;AACnB,wBAAY,KAAK,QAAQ,GAAG,CAAC,CAAC;AAAA,UAC/B;AACD,gBAAM,KAAK,IAAI,QAAQ,GAAG,WAAW;AAAA,QACtC;AACD;AAAA,MACF,KAAK;AACH,YAAI,MAAM,QAAQ;AAChB,cAAI,KAAK,MAAM,CAAC;AAChB,cAAI,KAAK,MAAM,CAAC;AAChB,gBAAM,KAAK,IAAI,QAAQ,IAAI,CAAC,QAAQ,IAAI,EAAE,GAAG,QAAQ,IAAI,EAAE,CAAC,CAAC;AAAA,QAC9D;AACD;AAAA,MACF,KAAK;AACH,YAAI,MAAM,QAAQ;AAChB,cAAI,CAAC,GAAG,CAAC,IAAI;AACb,cAAI,YAAY,IAAI,KAAK,CAAC;AAC1B,cAAI,UAAU,IAAI,KAAK,CAAC;AACxB,gBAAM,KAAK,IAAI,QAAQ,IAAI,CAAC,QAAQ,IAAI,SAAS,GAAG,QAAQ,IAAI,OAAO,CAAC,CAAC;AAAA,QAC1E;AACD;AAAA,MACF,KAAK;AACH,YAAI,MAAM,QAAQ;AAChB,cAAI,CAAC,WAAW,OAAO,IAAI;AAC3B,gBAAM,KAAK,IAAI,QAAQ,IAAI,CAAC,QAAQ,IAAI,SAAS,GAAG,QAAQ,IAAI,OAAO,CAAC,CAAC;AAAA,QAC1E;AACD;AAAA,IACH;AAAA,EACF;AACD,SAAO;AACT;;;"}