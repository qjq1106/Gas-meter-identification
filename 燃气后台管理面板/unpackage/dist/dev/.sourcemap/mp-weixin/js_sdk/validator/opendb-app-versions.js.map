{"version":3,"file":"opendb-app-versions.js","sources":["js_sdk/validator/opendb-app-versions.js"],"sourcesContent":["// 表单校验规则由 schema2code 生成，不建议直接修改校验规则，而建议通过 schema2code 生成, 详情: https://uniapp.dcloud.net.cn/uniCloud/schema\r\n\r\nconst PLATFORM = [\r\n\t{\r\n\t\t\"value\": \"Android\",\r\n\t\t\"text\": \"安卓\"\r\n\t},\r\n\t{\r\n\t\t\"value\": \"iOS\",\r\n\t\t\"text\": \"苹果\"\r\n\t},\r\n\t{\r\n\t\t\"value\": \"Harmony\",\r\n\t\t\"text\": \"鸿蒙 Next\"\r\n\t}\r\n]\r\n\r\nconst validator = {\r\n\t\"appid\": {\r\n\t\t\"rules\": [{\r\n\t\t\t\t\"required\": true\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"format\": \"string\"\r\n\t\t\t}\r\n\t\t],\r\n\t\t\"label\": \"AppID\"\r\n\t},\r\n\t\"name\": {\r\n\t\t\"rules\": [{\r\n\t\t\t\"format\": \"string\"\r\n\t\t}],\r\n\t\t\"label\": \"应用名称\"\r\n\t},\r\n\t\"title\": {\r\n\t\t\"rules\": [{\r\n\t\t\t\"format\": \"string\"\r\n\t\t}],\r\n\t\t\"label\": \"更新标题\"\r\n\t},\r\n\t\"contents\": {\r\n\t\t\"rules\": [{\r\n\t\t\t\t\"required\": true\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"format\": \"string\"\r\n\t\t\t}\r\n\t\t],\r\n\t\t\"label\": \"更新内容\"\r\n\t},\r\n\t\"platform\": {\r\n\t\t\"rules\": [{\r\n\t\t\t\t\"required\": true\r\n\t\t\t},\r\n\t\t\t/* 此处不校验数据类型，因为platform在发布app端是单选，在发布wgt时可能是多选\r\n\t\t\t{\r\n\t\t\t\t\"format\": \"array\"\r\n\t\t\t}, */\r\n\t\t\t{\r\n\t\t\t\t\"range\": PLATFORM\r\n\t\t\t}\r\n\t\t],\r\n\t\t\"label\": \"平台\"\r\n\t},\r\n\t\"type\": {\r\n\t\t\"rules\": [{\r\n\t\t\t\t\"required\": true\r\n\t\t\t}, {\r\n\t\t\t\t\"format\": \"string\"\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"range\": [{\r\n\t\t\t\t\t\t\"value\": \"native_app\",\r\n\t\t\t\t\t\t\"text\": \"原生App安装包\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t\"value\": \"wgt\",\r\n\t\t\t\t\t\t\"text\": \"wgt资源包\"\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t],\r\n\t\t\"label\": \"安装包类型\"\r\n\t},\r\n\t\"version\": {\r\n\t\t\"rules\": [{\r\n\t\t\t\t\"required\": true\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"format\": \"string\"\r\n\t\t\t}\r\n\t\t],\r\n\t\t\"label\": \"版本号\"\r\n\t},\r\n\t\"min_uni_version\": {\r\n\t\t\"rules\": [{\r\n\t\t\t\"format\": \"string\"\r\n\t\t}],\r\n\t\t\"label\": \"原生App最低版本\"\r\n\t},\r\n\t\"url\": {\r\n\t\t\"rules\": [{\r\n\t\t\t\"required\": true\r\n\t\t}, {\r\n\t\t\t\"format\": \"string\"\r\n\t\t}],\r\n\t\t\"label\": \"链接\"\r\n\t},\r\n\t\"stable_publish\": {\r\n\t\t\"rules\": [{\r\n\t\t\t\"format\": \"bool\"\r\n\t\t}],\r\n\t\t\"label\": \"上线发行\"\r\n\t},\r\n\t\"create_date\": {\r\n\t\t\"rules\": [{\r\n\t\t\t\"format\": \"timestamp\"\r\n\t\t}],\r\n\t\t\"label\": \"上传时间\"\r\n\t},\r\n\t\"is_silently\": {\r\n\t\t\"rules\": [{\r\n\t\t\t\"format\": \"bool\"\r\n\t\t}],\r\n\t\t\"label\": \"静默更新\",\r\n\t\t\"defaultValue\": false\r\n\t},\r\n\t\"is_mandatory\": {\r\n\t\t\"rules\": [{\r\n\t\t\t\"format\": \"bool\"\r\n\t\t}],\r\n\t\t\"label\": \"强制更新\",\r\n\t\t\"defaultValue\": false\r\n\t},\r\n\t\"uni_platform\": {\r\n\t\t\"rules\": [\r\n\t\t\t{\r\n\t\t\t\t\"required\": true\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"format\": \"string\"\r\n\t\t\t}\r\n\t\t],\r\n\t\t\"label\": \"uni 平台\"\r\n\t},\r\n\t\"create_env\": {\r\n\t\t\"rules\": [\r\n\t\t\t{\r\n\t\t\t\t\"required\": true\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\t\"format\": \"string\"\r\n\t\t\t}\r\n\t\t]\r\n\t},\r\n\t\"store_list\": {\r\n\t\t\"rules\": [{\r\n\t\t\t\"format\": \"array\"\r\n\t\t}],\r\n\t\t\"label\": \"应用市场\"\r\n\t},\r\n}\r\n\r\nconst enumConverter = {\r\n\t\"platform_valuetotext\": PLATFORM,\r\n\t\"type_valuetotext\": {\r\n\t\t\"native_app\": \"原生App安装包\",\r\n\t\t\"wgt\": \"wgt资源包\"\r\n\t}\r\n}\r\n\r\nfunction filterToWhere(filter, command) {\r\n  let where = {}\r\n  for (let field in filter) {\r\n    let { type, value } = filter[field]\r\n    switch (type) {\r\n      case \"search\":\r\n        if (typeof value === 'string' && value.length) {\r\n          where[field] = new RegExp(value)\r\n        }\r\n        break;\r\n      case \"select\":\r\n        if (value.length) {\r\n          let selectValue = []\r\n          for (let s of value) {\r\n            selectValue.push(command.eq(s))\r\n          }\r\n          where[field] = command.or(selectValue)\r\n        }\r\n        break;\r\n      case \"range\":\r\n        if (value.length) {\r\n          let gt = value[0]\r\n          let lt = value[1]\r\n          where[field] = command.and([command.gte(gt), command.lte(lt)])\r\n        }\r\n        break;\r\n      case \"date\":\r\n        if (value.length) {\r\n          let [s, e] = value\r\n          let startDate = new Date(s)\r\n          let endDate = new Date(e)\r\n          where[field] = command.and([command.gte(startDate), command.lte(endDate)])\r\n        }\r\n        break;\r\n      case \"timestamp\":\r\n        if (value.length) {\r\n          let [startDate, endDate] = value\r\n          where[field] = command.and([command.gte(startDate), command.lte(endDate)])\r\n        }\r\n        break;\r\n    }\r\n  }\r\n  return where\r\n}\r\n\r\n\r\nexport {\r\n\tvalidator,\r\n\tenumConverter,\r\n\tfilterToWhere\r\n}\r\n"],"names":[],"mappings":"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"}