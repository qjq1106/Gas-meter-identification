{"version":3,"file":"uni-data-menu.js","sources":["components/uni-data-menu/uni-data-menu.vue","../../../../微信开发者工具/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RTovdGVzdFByb2plY3RzL1dlQ2hhdFByb2plY3RzL3Rlc3RQcm9qZWN0LTIv54eD5rCU5ZCO5Y-w566h55CG6Z2i5p2_L2NvbXBvbmVudHMvdW5pLWRhdGEtbWVudS91bmktZGF0YS1tZW51LnZ1ZQ"],"sourcesContent":["<template>\r\n\t<view>\r\n\t\t<uni-nav-menu :active=\"value\" activeKey=\"value\" :activeTextColor=\"activeTextColor\" :uniqueOpened=\"uniqueOpened\"\r\n\t\t\t@select=\"onSelect\">\r\n\t\t\t<uni-menu-sidebar :data=\"userMenu\"></uni-menu-sidebar>\r\n\t\t\t<uni-menu-sidebar :data=\"staticMenu\"></uni-menu-sidebar>\r\n\t\t</uni-nav-menu>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport {\r\n\t\tmapActions\r\n\t} from 'vuex'\r\n\timport {\r\n\t\tbuildMenus\r\n\t} from './util.js'\r\n\texport default {\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tmenus: [],\r\n\t\t\t\tuserMenu: [],\r\n\t\t\t\tfamliy: [],\r\n\r\n\t\t\t};\r\n\t\t},\r\n\t\tmixins: [uniCloud.mixinDatacom],\r\n\t\tprops: {\r\n\t\t\t// 当前激活菜单的 url\r\n\t\t\tvalue: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: ''\r\n\t\t\t},\r\n\t\t\t// 当前激活菜单的文字颜色\r\n\t\t\tactiveTextColor: {\r\n\t\t\t\ttype: String,\r\n\t\t\t\tdefault: '#42B983'\r\n\t\t\t},\r\n\t\t\t// 是否只保持一个子菜单的展开\r\n\t\t\tuniqueOpened: {\r\n\t\t\t\ttype: Boolean,\r\n\t\t\t\tdefault: false\r\n\t\t\t},\r\n\t\t\tstaticMenu: {\r\n\t\t\t\ttype: Array,\r\n\t\t\t\tdefault () {\r\n\t\t\t\t\treturn []\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\twatch: {\r\n\t\t\tlocaldata: {\r\n\t\t\t\thandler(newval) {\r\n\t\t\t\t\tif (this.hasLocalData(newval)) {\r\n\t\t\t\t\t\tthis.userMenu = newval\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\timmediate: true\r\n\t\t\t},\r\n\t\t\t// TODO 暂时无需监听，需要看后面会出现什么问题\r\n\t\t\t// #ifdef H5\r\n\t\t\tmenus: {\r\n\t\t\t\timmediate: true,\r\n\t\t\t\thandler(newVal,oldVal) {\r\n\t\t\t\t\tconst item = this.menus.find(m => m.value === this.$route.path)\r\n\t\t\t\t\t// 设置面包屑\r\n\t\t\t\t\tif(item){\r\n\t\t\t\t\t\tthis.getMenuAncestor(item.menu_id, newVal)\r\n\t\t\t\t\t\titem && this.setRoutes && this.setRoutes(this.famliy)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// #endif\r\n\t\t\t$route: {\r\n\t\t\t\timmediate: false,\r\n\t\t\t\thandler(val, old) {\r\n\t\t\t\t\tif (val.fullPath !== old.fullPath) {\r\n\t\t\t\t\t\tthis.famliy = []\r\n\t\t\t\t\t\tconst menu = this.menus.find(m => m.value === val.path)\r\n\t\t\t\t\t\tconst menu_id = menu && menu.menu_id\r\n\t\t\t\t\t\tthis.getMenuAncestor(menu_id, this.menus)\r\n\t\t\t\t\t\tthis.setRoutes && this.setRoutes(this.famliy)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t\tcreated() {\r\n\t\t\tif (this.hasLocalData(this.localdata)) return\r\n\t\t\t// #ifndef H5\r\n\t\t\tthis.load()\r\n\t\t\t// #endif\r\n\t\t},\r\n\t\t// computed:{\r\n\t\t// \tuserMenu() {\r\n\t\t// \t\treturn this.getUserMenu(this.menus)\r\n\t\t// \t}\r\n\t\t// },\r\n\t\tmethods: {\r\n\t\t\t...mapActions({\r\n\t\t\t\tsetRoutes: 'app/setRoutes'\r\n\t\t\t}),\r\n\t\t\tgetUserMenu(menuList) {\r\n\t\t\t\tconst {\r\n\t\t\t\t\tpermission,\r\n\t\t\t\t\trole\r\n\t\t\t\t} = uniCloud.getCurrentUserInfo()\r\n\t\t\t\t// 标记叶子节点\r\n\t\t\t\tmenuList.map(item => {\r\n\t\t\t\t\tif (!menuList.some(subMenuItem => subMenuItem.parent_id === item.menu_id)) {\r\n\t\t\t\t\t\titem.isLeafNode = true\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\r\n\t\t\t\t// 删除无权限访问的菜单\r\n\t\t\t\tif (!role.includes('admin')) {\r\n\t\t\t\t\tmenuList = menuList.filter(item => {\r\n\t\t\t\t\t\tif (item.isLeafNode) {\r\n\t\t\t\t\t\t\tif (item.permission && item.permission.length) {\r\n\t\t\t\t\t\t\t\treturn item.permission.some(item => permission.indexOf(item) > -1)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\treturn false\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn true\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t\treturn buildMenus(menuList)\r\n\t\t\t},\r\n\t\t\tonSelect(menu) {\r\n\r\n\t\t\t\tthis.famliy = []\r\n\t\t\t\tthis.getMenuAncestor(menu.menu_id, this.menus)\r\n\t\t\t\tthis.emit(menu)\r\n\t\t\t},\r\n\t\t\temit(menu) {\r\n\t\t\t\tthis.$emit('select', menu, this.famliy)\r\n\t\t\t\tthis.$emit('input', menu.value)\r\n\t\t\t},\r\n\t\t\thasLocalData(value) {\r\n\t\t\t\treturn Array.isArray(value) && value.length > 0\r\n\t\t\t},\r\n\t\t\tload() {\r\n\t\t\t\tif (this.mixinDatacomLoading == true) {\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\tthis.mixinDatacomLoading = true\r\n\t\t\t\tthis.mixinDatacomGet().then((res) => {\r\n\t\t\t\t\tthis.mixinDatacomLoading = false\r\n\t\t\t\t\tconst {\r\n\t\t\t\t\t\tdata,\r\n\t\t\t\t\t\tcount\r\n\t\t\t\t\t} = res.result\r\n\t\t\t\t\tthis.menus = data\r\n\t\t\t\t\tthis.userMenu = this.getUserMenu(this.menus)\r\n\t\t\t\t}).catch((err) => {\r\n\t\t\t\t\tthis.mixinDatacomLoading = false\r\n\t\t\t\t\tthis.mixinDatacomErrorMessage = err\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\tgetMenuAncestor(menuId, menus) {\r\n\t\t\t\tmenus.forEach(item => {\r\n\t\t\t\t\tif (item.menu_id === menuId) {\r\n\t\t\t\t\t\tconst route = {\r\n\t\t\t\t\t\t\tname: item.text\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tconst path = item.value\r\n\t\t\t\t\t\tif (path) {\r\n\t\t\t\t\t\t\troute.to = {\r\n\t\t\t\t\t\t\t\tpath\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.famliy.unshift(route)\r\n\t\t\t\t\t\tconst parent_id = item.parent_id\r\n\t\t\t\t\t\tif (parent_id) {\r\n\t\t\t\t\t\t\tthis.getMenuAncestor(parent_id, menus)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t// return famliy\r\n\t\t\t}\r\n\t\t},\r\n\t}\r\n</script>\r\n\r\n<style>\r\n\r\n</style>\r\n","import Component from 'E:/testProjects/WeChatProjects/testProject-2/燃气后台管理面板/components/uni-data-menu/uni-data-menu.vue'\nwx.createComponent(Component)"],"names":["uniCloud","mapActions","item","buildMenus"],"mappings":"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"}