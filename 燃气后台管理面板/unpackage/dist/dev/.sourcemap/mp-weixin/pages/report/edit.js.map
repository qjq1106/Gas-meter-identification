{"version":3,"file":"edit.js","sources":["pages/report/edit.vue","../../../../微信开发者工具/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcmVwb3J0L2VkaXQudnVl"],"sourcesContent":["<template>\r\n\t<view class=\"uni-container\">\r\n\t\t<uni-forms ref=\"form\" :model=\"formData\" :rules=\"rules\" validate-trigger=\"submit\" err-show-type=\"toast\">\r\n\t\t\t<uni-forms-item label=\"当前读数\" name=\"reading\" required>\r\n\t\t\t\t<uni-easyinput v-model=\"formData.reading\" placeholder=\"请输入当前读数\" />\r\n\t\t\t</uni-forms-item>\r\n\t\t\t\r\n\t\t\t<uni-forms-item label=\"上次读数\" name=\"lastReading\">\r\n\t\t\t\t<uni-easyinput v-model=\"formData.lastReading\" placeholder=\"请输入上次读数\" />\r\n\t\t\t</uni-forms-item>\r\n\t\t\t\r\n\t\t\t<uni-forms-item label=\"整数部分\" name=\"integerPart\">\r\n\t\t\t\t<uni-easyinput v-model=\"formData.integerPart\" placeholder=\"请输入整数部分\" />\r\n\t\t\t</uni-forms-item>\r\n\t\t\t\r\n\t\t\t<uni-forms-item label=\"小数部分\" name=\"decimalPart\">\r\n\t\t\t\t<uni-easyinput v-model=\"formData.decimalPart\" placeholder=\"请输入小数部分\" />\r\n\t\t\t</uni-forms-item>\r\n\t\t\t\r\n\t\t\t<uni-forms-item label=\"详细地址\" name=\"address\" required>\r\n\t\t\t\t<uni-easyinput v-model=\"formData.address\" placeholder=\"请输入详细地址\" />\r\n\t\t\t</uni-forms-item>\r\n\t\t\t\r\n\t\t\t<uni-forms-item label=\"楼栋号\" name=\"building\">\r\n\t\t\t\t<uni-data-select \r\n\t\t\t\t\tv-model=\"formData.building\" \r\n\t\t\t\t\t:localdata=\"buildingOptions\"\r\n\t\t\t\t\tplaceholder=\"请选择楼栋号\"\r\n\t\t\t\t/>\r\n\t\t\t</uni-forms-item>\r\n\t\t\t\r\n\t\t\t<uni-forms-item label=\"抄表日期\" name=\"date\" required>\r\n\t\t\t\t<uni-datetime-picker \r\n\t\t\t\t\tv-model=\"formData.date\" \r\n\t\t\t\t\ttype=\"date\"\r\n\t\t\t\t\tplaceholder=\"请选择抄表日期\"\r\n\t\t\t\t/>\r\n\t\t\t</uni-forms-item>\r\n\t\t\t\r\n\t\t\t<uni-forms-item label=\"抄表时间\" name=\"time\">\r\n\t\t\t\t<uni-datetime-picker \r\n\t\t\t\t\tv-model=\"formData.time\" \r\n\t\t\t\t\ttype=\"time\"\r\n\t\t\t\t\tplaceholder=\"请选择抄表时间\"\r\n\t\t\t\t/>\r\n\t\t\t</uni-forms-item>\r\n\t\t\t\r\n\t\t\t<uni-forms-item label=\"报告状态\" name=\"status\">\r\n\t\t\t\t<uni-data-select \r\n\t\t\t\t\tv-model=\"formData.status\" \r\n\t\t\t\t\t:localdata=\"statusOptions\"\r\n\t\t\t\t\tplaceholder=\"请选择报告状态\"\r\n\t\t\t\t/>\r\n\t\t\t</uni-forms-item>\r\n\t\t\t\r\n\t\t\t<uni-forms-item label=\"备注信息\" name=\"remark\">\r\n\t\t\t\t<uni-easyinput \r\n\t\t\t\t\tv-model=\"formData.remark\" \r\n\t\t\t\t\ttype=\"textarea\" \r\n\t\t\t\t\tplaceholder=\"请输入备注信息\" \r\n\t\t\t\t\t:maxlength=\"200\"\r\n\t\t\t\t/>\r\n\t\t\t</uni-forms-item>\r\n\t\t\t\r\n\t\t\t<uni-forms-item label=\"燃气表图片\" name=\"imageUrl\" required>\r\n\t\t\t\t<uni-file-picker \r\n\t\t\t\t\tv-model=\"formData.imageUrl\" \r\n\t\t\t\t\tfile-mediatype=\"image\"\r\n\t\t\t\t\tmode=\"grid\"\r\n\t\t\t\t\t:limit=\"1\"\r\n\t\t\t\t\t:auto-upload=\"true\"\r\n\t\t\t\t/>\r\n\t\t\t</uni-forms-item>\r\n\t\t</uni-forms>\r\n\t\t\r\n\t\t<view class=\"uni-button-group\">\r\n\t\t\t<button class=\"uni-button uni-button--default\" @click=\"cancel\">取消</button>\r\n\t\t\t<button class=\"uni-button uni-button--primary\" @click=\"submit\">更新</button>\r\n\t\t</view>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\nconst db = uniCloud.database()\r\nconst dbCollectionName = 'report'\r\n\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tformData: {\r\n\t\t\t\treading: '',\r\n\t\t\t\tlastReading: '',\r\n\t\t\t\tintegerPart: '',\r\n\t\t\t\tdecimalPart: '',\r\n\t\t\t\taddress: '',\r\n\t\t\t\tbuilding: '',\r\n\t\t\t\tdate: '',\r\n\t\t\t\ttime: '',\r\n\t\t\t\tstatus: '已识别',\r\n\t\t\t\tremark: '',\r\n\t\t\t\timageUrl: []\r\n\t\t\t},\r\n\t\t\trules: {\r\n\t\t\t\treading: {\r\n\t\t\t\t\trules: [{\r\n\t\t\t\t\t\trequired: true,\r\n\t\t\t\t\t\terrorMessage: '读数不能为空'\r\n\t\t\t\t\t}]\r\n\t\t\t\t},\r\n\t\t\t\taddress: {\r\n\t\t\t\t\trules: [{\r\n\t\t\t\t\t\trequired: true,\r\n\t\t\t\t\t\terrorMessage: '地址不能为空'\r\n\t\t\t\t\t}]\r\n\t\t\t\t},\r\n\t\t\t\tdate: {\r\n\t\t\t\t\trules: [{\r\n\t\t\t\t\t\trequired: true,\r\n\t\t\t\t\t\terrorMessage: '日期不能为空'\r\n\t\t\t\t\t}]\r\n\t\t\t\t},\r\n\t\t\t\timageUrl: {\r\n\t\t\t\t\trules: [{\r\n\t\t\t\t\t\trequired: true,\r\n\t\t\t\t\t\terrorMessage: '图片不能为空'\r\n\t\t\t\t\t}]\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tbuildingOptions: [\r\n\t\t\t\t{ value: '1号楼', text: '1号楼' },\r\n\t\t\t\t{ value: '2号楼', text: '2号楼' },\r\n\t\t\t\t{ value: '3号楼', text: '3号楼' },\r\n\t\t\t\t{ value: '4号楼', text: '4号楼' },\r\n\t\t\t\t{ value: '5号楼', text: '5号楼' },\r\n\t\t\t\t{ value: '6号楼', text: '6号楼' },\r\n\t\t\t\t{ value: '7号楼', text: '7号楼' },\r\n\t\t\t\t{ value: '8号楼', text: '8号楼' },\r\n\t\t\t\t{ value: '9号楼', text: '9号楼' },\r\n\t\t\t\t{ value: '10号楼', text: '10号楼' },\r\n\t\t\t\t{ value: '11号楼', text: '11号楼' },\r\n\t\t\t\t{ value: '12号楼', text: '12号楼' }\r\n\t\t\t],\r\n\t\t\tstatusOptions: [\r\n\t\t\t\t{ value: '已识别', text: '已识别' },\r\n\t\t\t\t{ value: '已确认', text: '已确认' },\r\n\t\t\t\t{ value: '待审核', text: '待审核' },\r\n\t\t\t\t{ value: '异常', text: '异常' }\r\n\t\t\t],\r\n\t\t\trecordId: ''\r\n\t\t}\r\n\t},\r\n\tasync onLoad(options) {\r\n\t\tif (options.id) {\r\n\t\t\tthis.recordId = options.id\r\n\t\t\tawait this.loadData()\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\tasync loadData() {\r\n\t\t\ttry {\r\n\t\t\t\tconst res = await db.collection(dbCollectionName).doc(this.recordId).get()\r\n\t\t\t\tif (res.data.data && res.data.data.length > 0) {\r\n\t\t\t\t\tconst data = res.data.data[0]\r\n\t\t\t\t\tthis.formData = {\r\n\t\t\t\t\t\treading: data.reading || '',\r\n\t\t\t\t\t\tlastReading: data.lastReading || '',\r\n\t\t\t\t\t\tintegerPart: data.integerPart || '',\r\n\t\t\t\t\t\tdecimalPart: data.decimalPart || '',\r\n\t\t\t\t\t\taddress: data.address || '',\r\n\t\t\t\t\t\tbuilding: data.building || '',\r\n\t\t\t\t\t\tdate: data.date || '',\r\n\t\t\t\t\t\ttime: data.time || '',\r\n\t\t\t\t\t\tstatus: data.status || '已识别',\r\n\t\t\t\t\t\tremark: data.remark || '',\r\n\t\t\t\t\t\timageUrl: (data.imageUrl && data.imageUrl.trim()) ? [data.imageUrl] : []\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} catch (err) {\r\n\t\t\t\tuni.$u.toast('加载数据失败')\r\n\t\t\t\tconsole.error(err)\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync submit() {\r\n\t\t\ttry {\r\n\t\t\t\tconst isValid = await this.$refs.form.validate()\r\n\t\t\t\tif (!isValid) return\r\n\t\t\t\t\r\n\t\t\t\t// 处理图片URL\r\n\t\t\t\tlet imageUrl = ''\r\n\t\t\t\tif (this.formData.imageUrl && this.formData.imageUrl.length > 0) {\r\n\t\t\t\t\timageUrl = this.formData.imageUrl[0].url || this.formData.imageUrl[0]\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tconst data = {\r\n\t\t\t\t\t...this.formData,\r\n\t\t\t\t\timageUrl: imageUrl,\r\n\t\t\t\t\tupdateTime: new Date()\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tconst res = await db.collection(dbCollectionName).doc(this.recordId).update(data)\r\n\t\t\t\t\r\n\t\t\t\tif (res.data.updated > 0) {\r\n\t\t\t\t\tuni.$u.toast('更新成功')\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\tuni.navigateBack()\r\n\t\t\t\t\t}, 1500)\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t} catch (err) {\r\n\t\t\t\tuni.$u.toast('更新失败')\r\n\t\t\t\tconsole.error(err)\r\n\t\t\t}\r\n\t\t},\r\n\t\tcancel() {\r\n\t\t\tuni.navigateBack()\r\n\t\t}\r\n\t}\r\n}\r\n</script>\r\n\r\n<style>\r\n.uni-container {\r\n\tpadding: 15px;\r\n}\r\n\r\n.uni-button-group {\r\n\tmargin-top: 30px;\r\n\tdisplay: flex;\r\n\tgap: 15px;\r\n}\r\n\r\n.uni-button {\r\n\tflex: 1;\r\n}\r\n</style>","import MiniProgramPage from 'E:/testProjects/WeChatProjects/testProject-2/燃气后台管理面板/pages/report/edit.vue'\nwx.createPage(MiniProgramPage)"],"names":["uniCloud","uni"],"mappings":"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"}