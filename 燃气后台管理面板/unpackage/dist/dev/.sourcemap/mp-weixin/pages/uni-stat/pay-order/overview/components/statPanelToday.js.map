{"version":3,"file":"statPanelToday.js","sources":["pages/uni-stat/pay-order/overview/components/statPanelToday.vue","../../../../微信开发者工具/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RTovdGVzdFByb2plY3RzL1dlQ2hhdFByb2plY3RzL3Rlc3RQcm9qZWN0LTIv54eD5rCU5ZCO5Y-w566h55CG6Z2i5p2_L3BhZ2VzL3VuaS1zdGF0L3BheS1vcmRlci9vdmVydmlldy9jb21wb25lbnRzL3N0YXRQYW5lbFRvZGF5LnZ1ZQ"],"sourcesContent":["<template>\r\n\t<!-- 历史数据统计面板（最近7天，本月，本季度，本月，总和 -->\r\n\t<view class=\"uni-stat--x p-m\">\r\n\t\t<view class=\"uni-stat-card-header\">今日数据</view>\r\n\t\t<uni-table :loading=\"loading\" border stripe emptyText=\"暂无更多数据\" style=\"min-height: 100px;\">\r\n\t\t\t<!-- 表头行 -->\r\n\t\t\t<uni-tr>\r\n\t\t\t\t<uni-th align=\"center\" class=\"th\"></uni-th>\r\n\t\t\t\t<uni-th align=\"center\" class=\"th\" v-for=\"(item,index) in panelData\" :key=\"index\">\r\n\t\t\t\t\t<uni-tooltip>\r\n\t\t\t\t\t\t<view class=\"uni-stat--sum-item-title\">\r\n\t\t\t\t\t\t\t{{ item.title }}\r\n\t\t\t\t\t\t\t<uni-icons class=\"ml-s\" type=\"help\" color=\"#666\" />\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<template v-slot:content>\r\n\t\t\t\t\t\t\t<view class=\"uni-stat-tooltip-s\">\r\n\t\t\t\t\t\t\t\t<view v-for=\"(item2,index2) in item.list\" :key=\"index2\">{{ item2.tooltip }}</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</template>\r\n\t\t\t\t\t</uni-tooltip>\r\n\t\t\t\t</uni-th>\r\n\t\t\t</uni-tr>\r\n\t\t\t<!-- 表格数据行 -->\r\n\t\t\t<uni-tr>\r\n\t\t\t\t<uni-td align=\"center\" class=\"td\">下单</uni-td>\r\n\t\t\t\t<uni-td align=\"center\" class=\"td\" v-for=\"(item, index) in panelData\" :key=\"index\">{{ item.list[0].value  }}</uni-td>\r\n\t\t\t</uni-tr>\r\n\t\t\t<uni-tr>\r\n\t\t\t\t<uni-td align=\"center\" class=\"td\">收款</uni-td>\r\n\t\t\t\t<uni-td align=\"center\" class=\"td\" v-for=\"(item, index) in panelData\" :key=\"index\">{{ item.list[1].value  }}</uni-td>\r\n\t\t\t</uni-tr>\r\n\t\t\t<uni-tr>\r\n\t\t\t\t<uni-td align=\"center\" class=\"td\">退款</uni-td>\r\n\t\t\t\t<uni-td align=\"center\" class=\"td\" v-for=\"(item, index) in panelData\" :key=\"index\">{{ item.list[2].value  }}</uni-td>\r\n\t\t\t</uni-tr>\r\n\t\t</uni-table>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport {\r\n\t\tformatterData,\r\n\t\tstringifyQuery,\r\n\t\tstringifyField,\r\n\t\tstringifyGroupField,\r\n\t\tgetTimeOfSomeDayAgo,\r\n\t\tformatDate,\r\n\t\tparseDateTime,\r\n\t\tdebounce,\r\n\t} from '@/js_sdk/uni-stat/util.js'\r\n\timport timeUtil from \"@/js_sdk/uni-stat/timeUtil.js\"\r\n\timport {\r\n\t\tfieldsMap,\r\n\t\tfieldsGroupMap,\r\n\t} from '../fieldsMap.js'\r\n\r\n\texport default {\r\n\t\tprops: {\r\n\t\t\tquery: {\r\n\t\t\t\ttype: [Object],\r\n\t\t\t\tdefault: function(){\r\n\t\t\t\t\treturn {}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\ttableName: 'uni-stat-pay-result',\r\n\t\t\t\tpanelData: fieldsGroupMap,\r\n\t\t\t\tloading: false\r\n\t\t\t}\r\n\t\t},\r\n\t\tcreated() {\r\n\t\t\tthis.getCloudDataDebounce = debounce(() => {\r\n\t\t\t\tthis.getCloudData();\r\n\t\t\t}, 300);\r\n\t\t\tthis.getCloudDataDebounce();\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\t// 获取云端数据\r\n\t\t\tgetCloudData() {\r\n\t\t\t\tlet query = this.query;\r\n\t\t\t\tif (!query.appid) return;\r\n\t\t\t\tthis.loading = true;\r\n\t\t\t\tconst where = stringifyQuery({\r\n\t\t\t\t\t...query,\r\n\t\t\t\t\tstart_time: [getTimeOfSomeDayAgo(0), Date.now()]\r\n\t\t\t\t}, true, ['uni_platform']);\r\n\t\t\t\t//console.log('where: ', where)\r\n\t\t\t\tconst db = uniCloud.database();\r\n\t\t\t\tconst subTable = db.collection(this.tableName)\r\n\t\t\t\t\t.where(where)\r\n\t\t\t\t\t.field(`${stringifyField(fieldsMap)}, dimension, stat_date.date_str as stat_time, start_time`)\r\n\t\t\t\t\t.groupBy(`stat_time, dimension`)\r\n\t\t\t\t\t.groupField(stringifyGroupField(fieldsMap))\r\n\t\t\t\t\t.orderBy('stat_time', 'desc')\r\n\t\t\t\t\t.get()\r\n\t\t\t\t\t.then(res => {\r\n\t\t\t\t\t\tlet data = res.result.data;\r\n\t\t\t\t\t\t// 数据格式化\r\n\t\t\t\t\t\tdata = formatterData({\r\n\t\t\t\t\t\t\tfieldsMap,\r\n\t\t\t\t\t\t\tdata\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\t//console.log('data: ', data)\r\n\t\t\t\t\t\t// 获取今日数据\r\n\t\t\t\t\t\tlet today = data.find((item) => {\r\n\t\t\t\t\t\t\treturn item.dimension === 'day' && item.stat_time === parseDateTime(getTimeOfSomeDayAgo(0), '');\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tif (!today) {\r\n\t\t\t\t\t\t\ttoday = data.find((item) => {\r\n\t\t\t\t\t\t\t\treturn item.dimension === 'hour' && item.stat_time === parseDateTime(getTimeOfSomeDayAgo(0), '');\r\n\t\t\t\t\t\t\t}) || {};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.loading = false;\r\n\t\t\t\t\t\tthis.panelData = this.setPanelData(today);\r\n\t\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 设置面板数据\r\n\t\t\tsetPanelData(data){\r\n\t\t\t\tlet panelData = this.panelData;\r\n\t\t\t\tpanelData.map((item1, index1) => {\r\n\t\t\t\t\titem1.list.map((item2, index2) => {\r\n\t\t\t\t\t\titem2.value = data[item2.field] || 0;\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t\treturn panelData;\r\n\t\t\t}\r\n\t\t},\r\n\t\twatch: {\r\n\t\t\tquery: {\r\n\t\t\t\tdeep: true,\r\n\t\t\t\thandler(val) {\r\n\t\t\t\t\tthis.getCloudDataDebounce()\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t},\r\n\t}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n.uni-stat-tooltip-s {\r\n\twidth: 350px;\r\n\twhite-space: normal;\r\n}\r\n\r\n.uni-stat--sum {\r\n\t&-x {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tflex-wrap: wrap;\r\n\t\tborder-radius: 4px;\r\n\t\tpadding: 15px;\r\n\t\tbox-shadow: -1px -1px 5px 0 rgba(0, 0, 0, 0.1);\r\n\t}\r\n\r\n\t&-item {\r\n\t\twhite-space: nowrap;\r\n\t\ttext-align: center;\r\n\t\tmargin: 10px 18px;\r\n\r\n\t\t&-width {\r\n\t\t\twidth: 100px\r\n\t\t}\r\n\t}\r\n\r\n\t&-item-title {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tmin-height: 17px;\r\n\t\tfont-size: 12px;\r\n\t\tcolor: #666;\r\n\t}\r\n\r\n\t&-item-value {\r\n\t\tfont-size: 24px;\r\n\t\tline-height: 48px;\r\n\t\tfont-weight: 700;\r\n\t\tcolor: #333;\r\n\t}\r\n\r\n\t&-item-contrast {\r\n\t\tfont-size: 14px;\r\n\t\tcolor: #666;\r\n\t}\r\n}\r\n\r\n/* #ifndef APP-NVUE */\r\n@media screen and (max-width: 500px) {\r\n\t.uni-stat--sum-x {\r\n\t\tpadding: 15px 0;\r\n\t\talign-items: center;\r\n\t\tjustify-content: center;\r\n\t\tflex-wrap: unset;\r\n\t\toverflow-x: auto !important;\r\n\t}\r\n\r\n\t::-webkit-scrollbar {\r\n\t\tdisplay: none;\r\n\t}\r\n}\r\n\r\n/* #endif */\r\n\r\n.uni-stat--sum-flex{\r\n\tflex:1;\r\n\tdisplay: flex;\r\n\tjustify-content: flex-start;\r\n\tflex-wrap: wrap;\r\n\tborder-radius: 4px;\r\n\tpadding: 15px;\r\n\t.uni-stat--sum-item{\r\n\t\tmin-width: 300rpx;\r\n\t\tmax-width: 500rpx;\r\n\t\tflex:1;\r\n\t}\r\n}\r\n\r\n.uni-stat-card-header {\r\n\tjustify-content: space-between;\r\n\tcolor: #555;\r\n\tfont-size: 14px;\r\n\tfont-weight: 600;\r\n\tpadding: 10px 0;\r\n\tmargin-bottom: 15px;\r\n}\r\n.td.main{\r\n\tcolor:#e43d33;\r\n}\r\n</style>\r\n","import Component from 'E:/testProjects/WeChatProjects/testProject-2/燃气后台管理面板/pages/uni-stat/pay-order/overview/components/statPanelToday.vue'\nwx.createComponent(Component)"],"names":["fieldsGroupMap","debounce","stringifyQuery","getTimeOfSomeDayAgo","uniCloud","stringifyField","fieldsMap","stringifyGroupField","formatterData","parseDateTime"],"mappings":";;;;;AAwDC,MAAK,YAAU;AAAA,EACd,OAAO;AAAA,IACN,OAAO;AAAA,MACN,MAAM,CAAC,MAAM;AAAA,MACb,SAAS,WAAU;AAClB,eAAO,CAAC;AAAA,MACT;AAAA,IACA;AAAA,EACD;AAAA,EACD,OAAO;AACN,WAAO;AAAA,MACN,WAAW;AAAA,MACX,WAAWA,0CAAc;AAAA,MACzB,SAAS;AAAA,IACV;AAAA,EACA;AAAA,EACD,UAAU;AACT,SAAK,uBAAuBC,oBAAAA,SAAS,MAAM;AAC1C,WAAK,aAAY;AAAA,IACjB,GAAE,GAAG;AACN,SAAK,qBAAoB;AAAA,EACzB;AAAA,EACD,SAAS;AAAA;AAAA,IAER,eAAe;AACd,UAAI,QAAQ,KAAK;AACjB,UAAI,CAAC,MAAM;AAAO;AAClB,WAAK,UAAU;AACf,YAAM,QAAQC,oBAAAA,eAAe;AAAA,QAC5B,GAAG;AAAA,QACH,YAAY,CAACC,oBAAAA,oBAAoB,CAAC,GAAG,KAAK,IAAG,CAAE;AAAA,SAC7C,MAAM,CAAC,cAAc,CAAC;AAEzB,YAAM,KAAKC,iBAAS;AACH,SAAG,WAAW,KAAK,SAAS,EAC3C,MAAM,KAAK,EACX,MAAM,GAAGC,oBAAAA,eAAeC,0CAAAA,SAAS,CAAC,0DAA0D,EAC5F,QAAQ,sBAAsB,EAC9B,WAAWC,oBAAAA,oBAAoBD,0CAAAA,SAAS,CAAC,EACzC,QAAQ,aAAa,MAAM,EAC3B,IAAI,EACJ,KAAK,SAAO;AACZ,YAAI,OAAO,IAAI,OAAO;AAEtB,eAAOE,oBAAAA,cAAc;AAAA,UACpB,WAAAF,0CAAS;AAAA,UACT;AAAA,QACD,CAAC;AAGD,YAAI,QAAQ,KAAK,KAAK,CAAC,SAAS;AAC/B,iBAAO,KAAK,cAAc,SAAS,KAAK,cAAcG,oBAAa,cAACN,wCAAoB,CAAC,GAAG,EAAE;AAAA,QAC/F,CAAC;AACD,YAAI,CAAC,OAAO;AACX,kBAAQ,KAAK,KAAK,CAAC,SAAS;AAC3B,mBAAO,KAAK,cAAc,UAAU,KAAK,cAAcM,oBAAa,cAACN,wCAAoB,CAAC,GAAG,EAAE;AAAA,UAC/F,CAAA,KAAK,CAAA;AAAA,QACP;AACA,aAAK,UAAU;AACf,aAAK,YAAY,KAAK,aAAa,KAAK;AAAA,OACxC;AAAA,IACF;AAAA;AAAA,IAED,aAAa,MAAK;AACjB,UAAI,YAAY,KAAK;AACrB,gBAAU,IAAI,CAAC,OAAO,WAAW;AAChC,cAAM,KAAK,IAAI,CAAC,OAAO,WAAW;AACjC,gBAAM,QAAQ,KAAK,MAAM,KAAK,KAAK;AAAA,QACpC,CAAC;AAAA,MACF,CAAC;AACD,aAAO;AAAA,IACR;AAAA,EACA;AAAA,EACD,OAAO;AAAA,IACN,OAAO;AAAA,MACN,MAAM;AAAA,MACN,QAAQ,KAAK;AACZ,aAAK,qBAAqB;AAAA,MAC3B;AAAA,IACD;AAAA,EACA;AACF;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACxID,GAAG,gBAAgB,SAAS;"}