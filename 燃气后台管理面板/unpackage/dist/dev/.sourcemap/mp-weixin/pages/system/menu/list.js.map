{"version":3,"file":"list.js","sources":["pages/system/menu/list.vue","../../../../微信开发者工具/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXNcc3lzdGVtXG1lbnVcbGlzdC52dWU"],"sourcesContent":["<template>\r\n\t<view>\r\n\t\t<view class=\"uni-header\">\r\n\t\t\t<uni-stat-breadcrumb class=\"uni-stat-breadcrumb-on-phone\"/>\r\n\t\t</view>\r\n\t\t<view class=\"uni-tabs__header\">\r\n\t\t\t<view class=\"uni-tabs__nav-wrap\">\r\n\t\t\t\t<view class=\"uni-tabs__nav-scroll\">\r\n\t\t\t\t\t<view class=\"uni-tabs__nav\">\r\n\t\t\t\t\t\t<view @click=\"switchTab('menus')\" :class=\"{'is-active':currentTab==='menus'}\"\r\n\t\t\t\t\t\t\t  class=\"uni-tabs__item\">\r\n\t\t\t\t\t\t\t{{ $t('menu.text.menuManager') }}\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view @click=\"switchTab('pluginMenus')\" v-if=\"pluginMenus.length\"\r\n\t\t\t\t\t\t  :class=\"{'is-active':currentTab==='pluginMenus'}\" class=\"uni-tabs__item\">\r\n\t\t\t\t\t\t\t{{ $t('menu.text.additiveMenu') }}\r\n\t\t\t\t\t\t\t<uni-badge class=\"menu-badge\" :text=\"pluginMenus.length\" type=\"error\"></uni-badge>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view v-show=\"currentTab==='menus'\">\r\n\t\t\t<view class=\"uni-header\" style=\"border-bottom: 0;margin-bottom: -15px;\">\r\n\t\t\t\t<view class=\"uni-group\">\r\n\t\t\t\t\t<button @click=\"navigateTo('./add')\" size=\"mini\" plain=\"true\"\r\n\t\t\t\t\t\t\ttype=\"primary\">{{ $t('menu.button.addFirstLevelMenu') }}\r\n\t\t\t\t\t</button>\r\n\t\t\t\t\t<button @click=\"updateBuiltInMenu\" size=\"mini\" plain=\"true\" style=\"margin-left: 10px;\"\r\n\t\t\t\t\t\t\ttype=\"warn\">{{ $t('menu.button.updateBuiltInMenu') }}\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"uni-group\">\r\n\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"uni-container\">\r\n\t\t\t\t<unicloud-db ref=\"udb\" @load=\"onqueryload\" collection=\"opendb-admin-menus\" :options=\"options\"\r\n\t\t\t\t\t\t\t :where=\"where\" page-data=\"replace\" :orderby=\"orderby\" :getcount=\"true\"\r\n\t\t\t\t\t\t\t :page-size=\"options.pageSize\"\r\n\t\t\t\t\t\t\t :page-current=\"options.pageCurrent\" v-slot:default=\"{data,pagination,loading,error}\">\r\n\t\t\t\t\t<uni-table :loading=\"loading\" class=\"table-pc\" :emptyText=\"errMsg || $t('common.empty')\" border\r\n\t\t\t\t\t\t\t   stripe>\r\n\t\t\t\t\t\t<uni-tr>\r\n\t\t\t\t\t\t\t<uni-th align=\"center\">排序</uni-th>\r\n\t\t\t\t\t\t\t<uni-th width=\"200\" align=\"center\">名称</uni-th>\r\n\t\t\t\t\t\t\t<uni-th align=\"center\">标识</uni-th>\r\n\t\t\t\t\t\t\t<uni-th align=\"center\">URL</uni-th>\r\n\t\t\t\t\t\t\t<uni-th width=\"100\" align=\"center\">是否启用</uni-th>\r\n\t\t\t\t\t\t\t<uni-th align=\"center\">操作</uni-th>\r\n\t\t\t\t\t\t</uni-tr>\r\n\t\t\t\t\t\t<uni-tr v-for=\"(item,index) in data\" :key=\"index\">\r\n\t\t\t\t\t\t\t<uni-td align=\"center\">{{ item.sort }}</uni-td>\r\n\t\t\t\t\t\t\t<uni-td>{{ item.name }}</uni-td>\r\n\t\t\t\t\t\t\t<uni-td>{{ item.menu_id }}</uni-td>\r\n\t\t\t\t\t\t\t<uni-td>{{ item.url }}</uni-td>\r\n\t\t\t\t\t\t\t<uni-td align=\"center\" :class=\"{'menu-disable':!item.enable}\">\r\n\t\t\t\t\t\t\t\t<switch :checked=\"item.enable\" @change=\"enableChange(item)\" />\r\n\t\t\t\t\t\t\t\t<!-- {{ item.enable ? '已启用' : '未启用' }} -->\r\n\t\t\t\t\t\t\t</uni-td>\r\n\t\t\t\t\t\t\t<uni-td align=\"center\">\r\n\t\t\t\t\t\t\t\t<view class=\"uni-group\" style=\"justify-content: left;\">\r\n\t\t\t\t\t\t\t\t\t<button @click=\"navigateTo('./edit?id='+item._id, false)\" class=\"uni-button\"\r\n\t\t\t\t\t\t\t\t\t\t\tsize=\"mini\" type=\"primary\">{{ $t('common.button.edit') }}\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\tv-if=\"item.menu_id !== 'system_menu' && item.menu_id !== 'system_management'\"\r\n\t\t\t\t\t\t\t\t\t\t@click=\"confirmDelete(item)\" class=\"uni-button\" size=\"mini\"\r\n\t\t\t\t\t\t\t\t\t\ttype=\"warn\">{{ $t('common.button.delete') }}\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t<button v-if=\"!item.url\" @click=\"navigateTo('./add?parent_id='+item.menu_id, false)\"\r\n\t\t\t\t\t\t\t\t\t\t\tclass=\"uni-button\" size=\"mini\"\r\n\t\t\t\t\t\t\t\t\t\t\ttype=\"primary\">{{ $t('menu.button.addChildMenu') }}\r\n\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</uni-td>\r\n\t\t\t\t\t\t</uni-tr>\r\n\t\t\t\t\t</uni-table>\r\n\t\t\t\t</unicloud-db>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<view v-show=\"currentTab==='pluginMenus'\">\r\n\t\t\t<view class=\"uni-header\" style=\"border-bottom: 0;margin-bottom: -15px;\">\r\n\t\t\t\t<view class=\"uni-group\">\r\n\t\t\t\t\t<button style=\"width: 130px;\" @click=\"addPluginMenus\" size=\"mini\" type=\"primary\">添加选中的菜单\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</view>\r\n\t\t\t\t<view class=\"uni-group\"></view>\r\n\t\t\t</view>\r\n\t\t\t<view class=\"uni-container\">\r\n\t\t\t\t<uni-table ref=\"pluginMenusTable\" type=\"selection\" border stripe\r\n\t\t\t\t\t\t   @selection-change=\"pluginMenuSelectChange\">\r\n\t\t\t\t\t<uni-tr>\r\n\t\t\t\t\t\t<uni-th align=\"center\">名称（标识）</uni-th>\r\n\t\t\t\t\t\t<uni-th align=\"center\">URL</uni-th>\r\n\t\t\t\t\t\t<uni-th align=\"center\">插件菜单 json 文件</uni-th>\r\n\t\t\t\t\t</uni-tr>\r\n\t\t\t\t\t<uni-tr v-for=\"(item,index) in pluginMenus\" :key=\"index\">\r\n\t\t\t\t\t\t<uni-td>{{ item.name }}（{{ item.menu_id }}）</uni-td>\r\n\t\t\t\t\t\t<uni-td>{{ item.url }}</uni-td>\r\n\t\t\t\t\t\t<uni-td>{{ item.json }}</uni-td>\r\n\t\t\t\t\t</uni-tr>\r\n\t\t\t\t</uni-table>\r\n\t\t\t\t<view class=\"uni-sub-title\" style=\"margin-top: 15px;\">\r\n\t\t\t\t\t以上待添加菜单来自于三方插件，添加后，将显示在菜单管理中，若不希望显示在上述表格中时，可手动删除项目中对应的`插件id-menu.json`文件。\r\n\t\t\t\t</view>\r\n\t\t\t</view>\r\n\t\t</view>\r\n\t\t<!-- #ifndef H5 -->\r\n\t\t<fix-window/>\r\n\t\t<!-- #endif -->\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n\tbuildMenus\r\n} from '../../../components/uni-data-menu/util.js'\r\n\r\nimport originalMenuList from './originalMenuList.json'\r\n\r\nconst db = uniCloud.database()\r\n// 表查询配置\r\nconst dbOrderBy = 'create_date asc'\r\n// 分页配置\r\nconst pageSize = 20000\r\nconst pageCurrent = 1\r\n// 查找插件注册的菜单列表（目前仅在开发模式启用，仅限 admin 角色）\r\nconst pluginMenuJsons = []\r\n\r\nif (process.env.NODE_ENV === 'development') {\r\n\t// #ifdef VUE2\r\n\tconst rootModules = require.context(\r\n\t\t'../../../',\r\n\t\tfalse,\r\n\t\t/-menu.json$/\r\n\t)\r\n\trootModules.keys().forEach(function (key) {\r\n\t\tconst json = key.substr(2)\r\n\t\trootModules(key).forEach(item => {\r\n\t\t\titem.json = json\r\n\t\t\tpluginMenuJsons.push(item)\r\n\t\t})\r\n\t})\r\n\r\n\tconst pluginModules = require.context(\r\n\t\t'../../../uni_modules/',\r\n\t\ttrue,\r\n\t\t/menu.json$/\r\n\t)\r\n\tpluginModules.keys().forEach(function (key) {\r\n\t\tconst json = 'uni_modules' + key.substr(1)\r\n\t\tpluginModules(key).forEach(item => {\r\n\t\t\titem.json = json\r\n\t\t\tpluginMenuJsons.push(item)\r\n\t\t})\r\n\t})\r\n\t// #endif\r\n\t// #ifdef VUE3\r\n\tconst rootModules = import.meta.glob('../../../uni_modules/*/*-menu.json', {eager: true});\r\n\tfor (const modulePath in rootModules) {\r\n\t\tconst json = modulePath.replace(/^..\\/..\\/..\\//, '');\r\n\t\tlet moduleItem = rootModules[modulePath];\r\n\t\tif (typeof moduleItem === \"function\") {\r\n\t\t\t// 兼容 HBX3.6.5或以下版本\r\n\t\t\tmoduleItem().then(module => {\r\n\t\t\t\tmodule = module.default ? module.default : module\r\n\t\t\t\tmodule.forEach(item => {\r\n\t\t\t\t\titem.json = json\r\n\t\t\t\t\tpluginMenuJsons.push(item)\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\t// 兼容 HBX3.6.13或以上版本\r\n\t\t\tlet module = moduleItem.default ? moduleItem.default : moduleItem;\r\n\t\t\tmodule.forEach(item => {\r\n\t\t\t\titem.json = json\r\n\t\t\t\tpluginMenuJsons.push(item)\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tconst pluginModules = import.meta.glob('../../../uni_modules/**/menu.json', {eager: true});\r\n\tfor (const modulePath in pluginModules) {\r\n\t\tconst json = modulePath.replace(/^..\\/..\\/..\\//, '');\r\n\t\tlet moduleItem = pluginModules[modulePath];\r\n\t\tif (typeof moduleItem === \"function\") {\r\n\t\t\t// 兼容 HBX3.6.5或以下版本\r\n\t\t\tmoduleItem().then(module => {\r\n\t\t\t\tmodule = module.default ? module.default : module\r\n\t\t\t\tmodule.forEach(item => {\r\n\t\t\t\t\titem.json = json\r\n\t\t\t\t\tpluginMenuJsons.push(item)\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\t// 兼容 HBX3.6.13或以上版本\r\n\t\t\tlet module = moduleItem.default ? moduleItem.default : moduleItem;\r\n\t\t\tmodule.forEach(item => {\r\n\t\t\t\titem.json = json\r\n\t\t\t\tpluginMenuJsons.push(item)\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t// #endif\r\n}\r\n\r\n\r\n// 获取父的个数\r\nfunction getParents(menus, id, depth = 0) {\r\n\tmenus.forEach(menu => {\r\n\t\tif (menu.menu_id === id && menu.parent_id) {\r\n\t\t\tdepth = depth + 1 + getParents(menus, menu.parent_id, depth)\r\n\t\t}\r\n\t})\r\n\treturn depth\r\n}\r\n\r\n// 获取子的 _id\r\nfunction getChildren(menus, id, childrenIds = []) {\r\n\tif (menus.find(menu => menu.parent_id === id)) {\r\n\t\tmenus.forEach(item => {\r\n\t\t\tif (item.parent_id === id) {\r\n\t\t\t\tchildrenIds.push(item._id)\r\n\t\t\t\tgetChildren(menus, item.menu_id, childrenIds)\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n\treturn childrenIds\r\n}\r\n\r\nexport default {\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tquery: '',\r\n\t\t\twhere: '',\r\n\t\t\torderby: dbOrderBy,\r\n\t\t\toptions: {\r\n\t\t\t\tpageSize,\r\n\t\t\t\tpageCurrent\r\n\t\t\t},\r\n\t\t\tselectedIndexs: [], //批量选中的项\r\n\t\t\tloading: true,\r\n\t\t\tmenus: [],\r\n\t\t\terrMsg: '',\r\n\t\t\tcurrentTab: 'menus',\r\n\t\t\tselectedPluginMenuIndexs: []\r\n\t\t}\r\n\t},\r\n\tcomputed: {\r\n\t\tpluginMenus() {\r\n\t\t\tconst menus = []\r\n\t\t\tif (!this.$hasRole('admin')) {\r\n\t\t\t\treturn menus\r\n\t\t\t}\r\n\t\t\tconst dbMenus = this.menus\r\n\t\t\tif (!dbMenus.length) {\r\n\t\t\t\treturn menus\r\n\t\t\t}\r\n\t\t\tpluginMenuJsons.forEach(menu => {\r\n\t\t\t\t// 查找尚未被注册到数据库中的菜单\r\n\t\t\t\tif (!dbMenus.find(item => item.menu_id === menu.menu_id)) {\r\n\t\t\t\t\tmenus.push(menu)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\treturn menus\r\n\t\t},\r\n\t},\r\n\twatch: {\r\n\t\tpluginMenus(val) {\r\n\t\t\tif (!val.length) {\r\n\t\t\t\tthis.currentTab = 'menus'\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\tmethods: {\r\n\t\tenableChange(item){\r\n\t\t\titem.enable = item.enable ? false : true;\r\n\t\t\tdb.collection(\"opendb-admin-menus\").doc(item._id).update({\r\n\t\t\t\tenable: item.enable\r\n\t\t\t});\r\n\t\t},\r\n\t\tgetSortMenu(menuList) {\r\n\t\t\t// 标记叶子节点\r\n\t\t\tmenuList.map(item => {\r\n\t\t\t\tif (!menuList.some(subMenuItem => subMenuItem.parent_id === item.menu_id)) {\r\n\t\t\t\t\titem.isLeafNode = true\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\treturn buildMenus(menuList)\r\n\t\t},\r\n\t\tonqueryload(data) {\r\n\t\t\tfor (let i = 0; i < data.length; i++) {\r\n\t\t\t\tlet item = data[i]\r\n\t\t\t\tconst depth = getParents(data, item.menu_id)\r\n\t\t\t\titem.name = (depth ? '　'.repeat(depth) + '|-' : '') + item.name\r\n\t\t\t}\r\n\t\t\tconst menuTree = this.getSortMenu(data)\r\n\t\t\tconst sortMenus = []\r\n\t\t\tthis.patTree(menuTree, sortMenus)\r\n\t\t\tdata.length = 0;\r\n\t\t\tdata.push(...sortMenus)\r\n\t\t\tthis.menus = data //仅导出当前页\r\n\t\t},\r\n\t\tpatTree(tree, sortMenus) {\r\n\t\t\ttree.forEach(item => {\r\n\t\t\t\tsortMenus.push(item)\r\n\t\t\t\tif (item.children.length) {\r\n\t\t\t\t\tthis.patTree(item.children, sortMenus)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\treturn sortMenus\r\n\t\t},\r\n\t\tswitchTab(tab) {\r\n\t\t\tthis.currentTab = tab\r\n\t\t},\r\n\t\tloadData(clear = true) {\r\n\t\t\tthis.$refs.udb.loadData({\r\n\t\t\t\tclear\r\n\t\t\t})\r\n\t\t},\r\n\t\tnavigateTo(url, clear) { // clear 表示刷新列表时是否清除当前页码，true 表示刷新并回到列表第 1 页，默认为 true\r\n\t\t\tuni.navigateTo({\r\n\t\t\t\turl,\r\n\t\t\t\tevents: {\r\n\t\t\t\t\trefreshData: () => {\r\n\t\t\t\t\t\tthis.loadData(clear)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\tconfirmDelete(menu) {\r\n\t\t\tlet ids = menu._id\r\n\t\t\tlet content = '是否删除该菜单？'\r\n\t\t\t// 如有子菜单\r\n\t\t\tconst children = getChildren(this.menus, menu.menu_id)\r\n\t\t\tif (children.length) content = '是否删除该菜单及其子菜单？'\r\n\t\t\tids = [ids, ...children]\r\n\t\t\tuni.showModal({\r\n\t\t\t\ttitle: '提示',\r\n\t\t\t\tcontent,\r\n\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\tif (!res.confirm) {\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.$refs.udb.remove(ids, {\r\n\t\t\t\t\t\tneedConfirm: false\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\tpluginMenuSelectChange(e) {\r\n\t\t\tthis.selectedPluginMenuIndexs = e.detail.index\r\n\t\t},\r\n\t\taddPluginMenus(confirmContent) {\r\n\t\t\tif (!this.selectedPluginMenuIndexs.length) {\r\n\t\t\t\treturn uni.showModal({\r\n\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\tcontent: '请选择要添加的菜单！',\r\n\t\t\t\t\tshowCancel: false\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t\tconst pluginMenus = this.pluginMenus\r\n\t\t\tconst menus = []\r\n\t\t\tthis.selectedPluginMenuIndexs.forEach(i => {\r\n\t\t\t\tconst menu = pluginMenus[i]\r\n\t\t\t\tif (menu) {\r\n\t\t\t\t\t// 拷贝一份，移除 json 字段\r\n\t\t\t\t\tconst dbMenu = JSON.parse(JSON.stringify(menu))\r\n\t\t\t\t\tdbMenu.enable = true;\r\n\t\t\t\t\tdelete dbMenu.json\r\n\t\t\t\t\tmenus.push(dbMenu)\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\tuni.showModal({\r\n\t\t\t\ttitle: '提示',\r\n\t\t\t\tcontent: '您确认要添加已选中的菜单吗？',\r\n\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\tif (!res.confirm) {\r\n\t\t\t\t\t\treturn\r\n\t\t\t\t\t}\r\n\t\t\t\t\tuni.showLoading({\r\n\t\t\t\t\t\tmask: true\r\n\t\t\t\t\t})\r\n\t\t\t\t\tconst checkAll = menus.length === pluginMenus.length\r\n\t\t\t\t\tuniCloud.database().collection('opendb-admin-menus').add(menus).then(res => {\r\n\t\t\t\t\t\t// this.init()\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\t\t\tcontent: '添加菜单成功！',\r\n\t\t\t\t\t\t\tshowCancel: false,\r\n\t\t\t\t\t\t\tsuccess: () => {\r\n\t\t\t\t\t\t\t\tthis.$refs.pluginMenusTable.clearSelection()\r\n\t\t\t\t\t\t\t\tif (checkAll) {\r\n\t\t\t\t\t\t\t\t\tthis.currentTab = 'menus'\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tthis.loadData()\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}).catch(err => {\r\n\t\t\t\t\t\tuni.showModal({\r\n\t\t\t\t\t\t\ttitle: '提示',\r\n\t\t\t\t\t\t\tcontent: err.message,\r\n\t\t\t\t\t\t\tshowCancel: false\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}).finally(() => {\r\n\t\t\t\t\t\tuni.hideLoading()\r\n\t\t\t\t\t})\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t},\r\n\t\t// 更新内置菜单\r\n\t\tasync updateBuiltInMenu(){\r\n\t\t\tuni.showModal({\r\n\t\t\t\ttitle: '提示',\r\n\t\t\t\tcontent: '确定更新内置菜单吗？\\n（该操作不会影响现有的菜单）',\r\n\t\t\t\tsuccess: async (res) => {\r\n\t\t\t\t\tif (res.confirm) {\r\n\t\t\t\t\t\tconst db = uniCloud.database();\r\n\t\t\t\t\t\tconst _ = db.command;\r\n\t\t\t\t\t\tlet menu_ids = originalMenuList.map((item, index) => {\r\n\t\t\t\t\t\t\treturn item.menu_id;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tuni.showLoading({\r\n\t\t\t\t\t\t\ttitle:\"更新中...\",\r\n\t\t\t\t\t\t\tmask:true\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\tlet addMenuList = [];\r\n\t\t\t\t\t\t\t// 读取菜单\r\n\t\t\t\t\t\t\tlet oldMenuListRes = await db.collection(\"opendb-admin-menus\").where({\r\n\t\t\t\t\t\t\t\tmenu_id: _.in[menu_ids]\r\n\t\t\t\t\t\t\t}).limit(500).get();\r\n\t\t\t\t\t\t\tlet oldMenuList = oldMenuListRes.result.data;\r\n\t\t\t\t\t\t\toriginalMenuList.map((item, index) => {\r\n\t\t\t\t\t\t\t\tlet oldMenuItem = oldMenuList.find((item2, index2, arr2) => {\r\n\t\t\t\t\t\t\t\t\treturn item2.menu_id === item.menu_id;\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\tif (!oldMenuItem) {\r\n\t\t\t\t\t\t\t\t\taddMenuList.push({\r\n\t\t\t\t\t\t\t\t\t\t...item,\r\n\t\t\t\t\t\t\t\t\t\tcreate_date: undefined\r\n\t\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t\tif (addMenuList && addMenuList.length > 0) {\r\n\t\t\t\t\t\t\t\t// 添加没有的菜单\r\n\t\t\t\t\t\t\t\tlet addRes = await db.collection(\"opendb-admin-menus\").add(addMenuList);\r\n\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\ttitle:`新增了${addRes.result.inserted}个菜单，即将刷新`,\r\n\t\t\t\t\t\t\t\t\ticon:\"none\"\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\t\t// #ifdef H5\r\n\t\t\t\t\t\t\t\t\twindow.location.reload();\r\n\t\t\t\t\t\t\t\t\t// #endif\r\n\t\t\t\t\t\t\t\t\t// #ifndef H5\r\n\t\t\t\t\t\t\t\t\tthis.loadData(true);\r\n\t\t\t\t\t\t\t\t\t// #endif\r\n\t\t\t\t\t\t\t\t}, 300);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tuni.showToast({\r\n\t\t\t\t\t\t\t\t\ttitle:\"菜单无变动\",\r\n\t\t\t\t\t\t\t\t\ticon:\"none\"\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} catch(err) {\r\n\t\t\t\t\t\t\tconsole.error(err)\r\n\t\t\t\t\t\t} finally {\r\n\t\t\t\t\t\t\tuni.hideLoading();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n}\r\n</script>\r\n<style>\r\n/* #ifndef H5 */\r\npage {\r\n\tpadding-top: 85px;\r\n}\r\n\r\n/* #endif */\r\n.menu-disable {\r\n\tcolor: red;\r\n}\r\n\r\n.menu-badge {\r\n\tposition: absolute;\r\n\ttop: 0;\r\n\tright: 5px;\r\n}\r\n</style>\r\n","import MiniProgramPage from 'E:/testProjects/WeChatProjects/testProject-2/燃气后台管理面板/pages/system/menu/list.vue'\nwx.createPage(MiniProgramPage)"],"names":["uniCloud","buildMenus","uni","res","db"],"mappings":"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"}