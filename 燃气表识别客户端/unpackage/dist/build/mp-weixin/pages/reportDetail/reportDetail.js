"use strict";const t=require("../../common/vendor.js"),e={data:()=>({reportData:{id:"",reading:"",lastReading:"",address:"",date:"",remark:"",status:"",imageUrl:""},editableRemark:"",isEditing:!1,originalRemark:""}),computed:{gasUsage(){if(this.reportData.reading&&this.reportData.lastReading){return(parseFloat(this.reportData.reading)-parseFloat(this.reportData.lastReading)).toFixed(2)}return"0.00"}},onLoad(t){this.reportData={id:t.reportId||t.id||Date.now().toString().slice(-6),reading:t.reading||"",lastReading:t.lastReading||"",address:decodeURIComponent(t.address||""),date:t.date||"",time:decodeURIComponent(t.time||""),remark:decodeURIComponent(t.remarks||""),status:t.status||"å·²è¯†åˆ«",imageUrl:decodeURIComponent(t.imageUrl||""),integerPart:t.integerPart||"",decimalPart:t.decimalPart||""},this.editableRemark=this.reportData.remark,this.originalRemark=this.reportData.remark},methods:{getStatusBgClass(t){switch(t){case"å·²ç¡®è®¤":return"status-confirmed-bg";case"å¾…å®¡æ ¸":return"status-pending-bg";case"å¼‚å¸¸":return"status-abnormal-bg";default:return"status-default-bg"}},getStatusClass(t){switch(t){case"å·²ç¡®è®¤":return"status-confirmed";case"å¾…å®¡æ ¸":return"status-pending";case"å¼‚å¸¸":return"status-abnormal";default:return"status-default"}},getStatusIcon(t){switch(t){case"å·²ç¡®è®¤":return"âœ…";case"å¾…å®¡æ ¸":return"â³";case"å¼‚å¸¸":return"âš ï¸";default:return"ðŸ“‹"}},getUsageTrend(){const t=parseFloat(this.gasUsage);return t>80?"trend-high":t>40?"trend-normal":"trend-low"},getTrendIcon(){const t=parseFloat(this.gasUsage);return t>80?"ðŸ“ˆ":t>40?"âž¡ï¸":"ðŸ“‰"},getTrendText(){const t=parseFloat(this.gasUsage);return t>80?"ç”¨é‡è¾ƒé«˜":t>40?"æ­£å¸¸ç”¨é‡":"ç”¨é‡è¾ƒä½Ž"},getCurrentTime:()=>(new Date).toLocaleTimeString("zh-CN",{hour12:!1}),previewImage(){this.reportData.imageUrl&&t.index.previewImage({urls:[this.reportData.imageUrl],current:this.reportData.imageUrl})},toggleEdit(){this.isEditing?this.saveRemark():this.isEditing=!0},async saveRemark(){try{const e=t.tr.importObject("gasMeter");0===(await e.updateReport(this.reportData.id,{remark:this.editableRemark})).errCode?(this.reportData.remark=this.editableRemark,this.originalRemark=this.editableRemark,this.isEditing=!1,t.index.showToast({title:"å¤‡æ³¨å·²ä¿å­˜",icon:"success"})):t.index.showToast({title:"ä¿å­˜å¤±è´¥",icon:"none"})}catch(e){console.error("ä¿å­˜å¤‡æ³¨å¤±è´¥:",e),t.index.showToast({title:"ä¿å­˜å¤±è´¥",icon:"none"})}},async confirmReport(){t.index.showModal({title:"ç¡®è®¤æŠ¥å‘Š",content:"ç¡®å®šè¦æäº¤æ­¤æŠ„è¡¨æŠ¥å‘Šå—ï¼Ÿ",confirmText:"ç¡®å®šæäº¤",cancelText:"ç»§ç»­ç¼–è¾‘",confirmColor:"#4CAF50",success:async e=>{if(e.confirm){t.index.showLoading({title:"æäº¤ä¸­..."});try{const e=t.tr.importObject("gasMeter"),a=await e.updateReport(this.reportData.id,{status:"å·²ç¡®è®¤"});t.index.hideLoading(),0===a.errCode?(t.index.showToast({title:"æŠ¥å‘Šå·²ç¡®è®¤",icon:"success"}),setTimeout((()=>{t.index.navigateBack()}),1500)):t.index.showToast({title:"æäº¤å¤±è´¥",icon:"none"})}catch(a){t.index.hideLoading(),console.error("ç¡®è®¤æŠ¥å‘Šå¤±è´¥:",a),t.index.showToast({title:"æäº¤å¤±è´¥",icon:"none"})}}}})}}};const a=t._export_sfc(e,[["render",function(e,a,r,s,i,n){return t.e({a:t.t(n.getStatusIcon(i.reportData.status)),b:t.t(i.reportData.status||"å·²è¯†åˆ«"),c:t.n(n.getStatusClass(i.reportData.status)),d:t.t(i.reportData.id||"001"),e:t.n(n.getStatusBgClass(i.reportData.status)),f:i.reportData.imageUrl},i.reportData.imageUrl?{g:i.reportData.imageUrl,h:t.o(((...t)=>n.previewImage&&n.previewImage(...t)))}:{},{i:t.t(i.reportData.reading),j:i.reportData.lastReading},i.reportData.lastReading?{k:t.t(i.reportData.lastReading)}:{},{l:i.reportData.lastReading},i.reportData.lastReading?{m:t.t(n.gasUsage),n:t.t(n.getTrendIcon()),o:t.t(n.getTrendText()),p:t.n(n.getUsageTrend())}:{},{q:t.t(i.reportData.address),r:t.t(i.reportData.date),s:t.t(n.getCurrentTime()),t:t.t(i.isEditing?"âœ…":"âœï¸"),v:t.t(i.isEditing?"ä¿å­˜":"ç¼–è¾‘"),w:t.o(((...t)=>n.toggleEdit&&n.toggleEdit(...t))),x:i.isEditing?1:"",y:!i.isEditing,z:i.editableRemark,A:t.o((t=>i.editableRemark=t.detail.value)),B:t.t(i.editableRemark.length),C:t.o(((...t)=>n.confirmReport&&n.confirmReport(...t)))})}],["__scopeId","data-v-bbb4bd71"]]);wx.createPage(a);
