"use strict";const t=require("../../common/vendor.js"),e={data:()=>({reportData:{id:"",reading:"",lastReading:"",address:"",date:"",remark:"",status:"",imageUrl:""},editableRemark:"",isEditing:!1,originalRemark:""}),computed:{gasUsage(){if(this.reportData.reading&&this.reportData.lastReading){return(parseFloat(this.reportData.reading)-parseFloat(this.reportData.lastReading)).toFixed(2)}return"0.00"}},onLoad(t){this.reportData={id:t.reportId||t.id||Date.now().toString().slice(-6),reading:t.reading||"",lastReading:t.lastReading||"",address:decodeURIComponent(t.address||""),date:t.date||"",time:decodeURIComponent(t.time||""),remark:decodeURIComponent(t.remarks||""),status:t.status||"已识别",imageUrl:decodeURIComponent(t.imageUrl||""),integerPart:t.integerPart||"",decimalPart:t.decimalPart||""},this.editableRemark=this.reportData.remark,this.originalRemark=this.reportData.remark},methods:{getStatusBgClass(t){switch(t){case"已确认":return"status-confirmed-bg";case"待审核":return"status-pending-bg";case"异常":return"status-abnormal-bg";default:return"status-default-bg"}},getStatusClass(t){switch(t){case"已确认":return"status-confirmed";case"待审核":return"status-pending";case"异常":return"status-abnormal";default:return"status-default"}},getStatusIcon(t){switch(t){case"已确认":return"✅";case"待审核":return"⏳";case"异常":return"⚠️";default:return"📋"}},getUsageTrend(){const t=parseFloat(this.gasUsage);return t>80?"trend-high":t>40?"trend-normal":"trend-low"},getTrendIcon(){const t=parseFloat(this.gasUsage);return t>80?"📈":t>40?"➡️":"📉"},getTrendText(){const t=parseFloat(this.gasUsage);return t>80?"用量较高":t>40?"正常用量":"用量较低"},getCurrentTime:()=>(new Date).toLocaleTimeString("zh-CN",{hour12:!1}),previewImage(){this.reportData.imageUrl&&t.index.previewImage({urls:[this.reportData.imageUrl],current:this.reportData.imageUrl})},toggleEdit(){this.isEditing?this.saveRemark():this.isEditing=!0},async saveRemark(){try{const e=t.tr.importObject("gasMeter");0===(await e.updateReport(this.reportData.id,{remark:this.editableRemark})).errCode?(this.reportData.remark=this.editableRemark,this.originalRemark=this.editableRemark,this.isEditing=!1,t.index.showToast({title:"备注已保存",icon:"success"})):t.index.showToast({title:"保存失败",icon:"none"})}catch(e){console.error("保存备注失败:",e),t.index.showToast({title:"保存失败",icon:"none"})}},async confirmReport(){t.index.showModal({title:"确认报告",content:"确定要提交此抄表报告吗？",confirmText:"确定提交",cancelText:"继续编辑",confirmColor:"#4CAF50",success:async e=>{if(e.confirm){t.index.showLoading({title:"提交中..."});try{const e=t.tr.importObject("gasMeter"),a=await e.updateReport(this.reportData.id,{status:"已确认"});t.index.hideLoading(),0===a.errCode?(t.index.showToast({title:"报告已确认",icon:"success"}),setTimeout((()=>{t.index.navigateBack()}),1500)):t.index.showToast({title:"提交失败",icon:"none"})}catch(a){t.index.hideLoading(),console.error("确认报告失败:",a),t.index.showToast({title:"提交失败",icon:"none"})}}}})}}};const a=t._export_sfc(e,[["render",function(e,a,r,s,i,n){return t.e({a:t.t(n.getStatusIcon(i.reportData.status)),b:t.t(i.reportData.status||"已识别"),c:t.n(n.getStatusClass(i.reportData.status)),d:t.t(i.reportData.id||"001"),e:t.n(n.getStatusBgClass(i.reportData.status)),f:i.reportData.imageUrl},i.reportData.imageUrl?{g:i.reportData.imageUrl,h:t.o(((...t)=>n.previewImage&&n.previewImage(...t)))}:{},{i:t.t(i.reportData.reading),j:i.reportData.lastReading},i.reportData.lastReading?{k:t.t(i.reportData.lastReading)}:{},{l:i.reportData.lastReading},i.reportData.lastReading?{m:t.t(n.gasUsage),n:t.t(n.getTrendIcon()),o:t.t(n.getTrendText()),p:t.n(n.getUsageTrend())}:{},{q:t.t(i.reportData.address),r:t.t(i.reportData.date),s:t.t(n.getCurrentTime()),t:t.t(i.isEditing?"✅":"✏️"),v:t.t(i.isEditing?"保存":"编辑"),w:t.o(((...t)=>n.toggleEdit&&n.toggleEdit(...t))),x:i.isEditing?1:"",y:!i.isEditing,z:i.editableRemark,A:t.o((t=>i.editableRemark=t.detail.value)),B:t.t(i.editableRemark.length),C:t.o(((...t)=>n.confirmReport&&n.confirmReport(...t)))})}],["__scopeId","data-v-bbb4bd71"]]);wx.createPage(a);
