"use strict";const e=require("../../common/vendor.js"),t={data:()=>({selectedCategory:"全部",categories:["全部","1号楼","2号楼","3号楼","4号楼","5号楼","6号楼","7号楼","8号楼","9号楼","10号楼","11号楼","12号楼"],reports:[],loading:!1}),onLoad(){this.loadReports()},onShow(){this.loadReports()},computed:{filteredReports(){return"全部"===this.selectedCategory?this.reports:this.reports.filter((e=>e.building===this.selectedCategory))},confirmedCount(){return this.filteredReports.filter((e=>"已确认"===e.status)).length},pendingCount(){return this.filteredReports.filter((e=>"待审核"===e.status)).length},abnormalCount(){return this.filteredReports.filter((e=>"异常"===e.status)).length}},methods:{async loadReports(){if(!this.loading){this.loading=!0;try{const t=e.tr.importObject("gasMeter"),r=await t.getReports(this.selectedCategory);0===r.errCode?this.reports=r.data.map((e=>({id:e._id,building:e.building||"未分配",address:e.address,reading:e.reading,lastReading:e.lastReading||"",date:e.date,status:e.status,remark:e.remark||"",integerPart:e.integerPart||"",decimalPart:e.decimalPart||"",imageUrl:e.imageUrl||"",time:e.time||"",updateTime:e.updateTime}))).sort(((e,t)=>{const r=new Date(e.updateTime||`${e.date} ${e.time}`).getTime();return new Date(t.updateTime||`${t.date} ${t.time}`).getTime()-r})):(console.error("加载报告失败:",r.errMsg),e.index.showToast({title:"加载数据失败",icon:"none"}))}catch(t){console.error("加载报告出错:",t),e.index.showToast({title:"网络错误",icon:"none"})}finally{this.loading=!1}}},selectCategory(e){this.selectedCategory=e,this.loadReports()},getStatusClass(e){switch(e){case"已确认":return"status-confirmed";case"待审核":return"status-pending";case"异常":return"status-abnormal";default:return"status-default"}},getUsage(e){if(e.reading&&e.lastReading){return(parseFloat(e.reading)-parseFloat(e.lastReading)).toFixed(2)}return"0.00"},viewReportDetail(t){e.index.navigateTo({url:`/pages/reportDetail/reportDetail?reportId=${t.id}&reading=${t.reading}&lastReading=${t.lastReading}&address=${encodeURIComponent(t.address)}&date=${t.date}&time=${encodeURIComponent(t.time)}&remarks=${encodeURIComponent(t.remark||"")}&status=${t.status}&imageUrl=${encodeURIComponent(t.imageUrl||"")}&integerPart=${t.integerPart}&decimalPart=${t.decimalPart}`})}}};const r=e._export_sfc(t,[["render",function(t,r,a,s,i,o){return e.e({a:e.t(o.filteredReports.length),b:e.t(o.confirmedCount),c:e.t(o.pendingCount),d:e.t(o.abnormalCount),e:e.f(i.categories,((t,r,a)=>e.e({a:e.t(t),b:i.selectedCategory===t},(i.selectedCategory,{}),{c:r,d:i.selectedCategory===t?1:"",e:e.o((e=>o.selectCategory(t)),r)}))),f:0===o.filteredReports.length},0===o.filteredReports.length?{g:e.t(i.selectedCategory)}:{h:e.f(o.filteredReports,((t,r,a)=>e.e({a:e.t(t.building),b:e.t(t.address),c:e.t(t.status),d:e.n(o.getStatusClass(t.status)),e:e.t(t.reading),f:e.t(o.getUsage(t)),g:e.t(t.date),h:t.remark},t.remark?{i:e.t(t.remark)}:{},{j:t.id,k:.1*r+"s",l:e.o((e=>o.viewReportDetail(t)),t.id)})))})}],["__scopeId","data-v-499ceab5"]]);wx.createPage(r);
